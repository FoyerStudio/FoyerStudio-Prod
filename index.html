<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ‚úÖ Basic SEO -->
  <title>Foyer Studio‚Ñ¢ ‚Äî Best Online Boutique in Kasaragod, Kerala</title>

 <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Playfair+Display:wght@500&display=swap" rel="stylesheet">
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>



  <meta name="description" content="Foyer Studio‚Ñ¢ is one of the best online boutiques in Kerala, offering elegant women's clothing in Kasaragod, Manjeshwar, and Kunjathur. Shop timeless fashion that inspires confidence and style. Visit foyerstudio.in or contact fashion@foyerstudio.in.">
  <meta name="keywords" content="best online boutique Kerala, women's boutique Kasaragod, online fashion store Manjeshwar, Kunjathur boutique, Foyer Studio, women's clothing, Kerala fashion boutique, best online seller near me, best boutique near me">
  <meta name="author" content="Foyer Studio">

  <!-- ‚úÖ Open Graph / Facebook / WhatsApp -->
  <meta property="og:title" content="Foyer Studio‚Ñ¢ - Best Online Boutique in Kerala">
  <meta property="og:description" content="Explore elegant women's clothing from Foyer Studio‚Ñ¢, a leading online boutique in Kasaragod, Manjeshwar, and Kunjathur, Kerala.">
  <meta property="og:image" content="https://foyerstudio.in/images/logo_red.png">
  <meta property="og:url" content="https://foyerstudio.in">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Foyer Studio">

  <!-- ‚úÖ Twitter (X) Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Foyer Studio‚Ñ¢ - Best Online Boutique in Kerala">
  <meta name="twitter:description" content="Discover timeless women's clothing from Foyer Studio‚Ñ¢ ‚Äî serving Kasaragod, Manjeshwar, and Kunjathur, Kerala.">
  <meta name="twitter:image" content="https://foyerstudio.in/images/logo_red.png">

  <!-- ‚úÖ Favicons -->
  <link rel="icon" href="/favicon.png" sizes="32x32" type="image/png">
  <link rel="apple-touch-icon" href="/favicon.png">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">

  <!-- ‚úÖ Canonical URL -->
  <link rel="canonical" href="https://foyerstudio.in">

  <!-- ‚úÖ Social Profiles -->
  <link rel="me" href="https://www.instagram.com/foyerstudio" />
  <link rel="me" href="https://wa.me/919037622566" />

  <!-- ‚úÖ Structured Data: Organization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Foyer Studio",
    "url": "https://foyerstudio.in",
    "logo": "https://foyerstudio.in/images/logo_red.png",
    "email": "fashion@foyerstudio.in",
    "sameAs": [
      "https://www.instagram.com/foyerstudio",
      "https://wa.me/919037622566"
    ],
    "description": "Foyer Studio‚Ñ¢ is an online boutique dedicated to timeless women‚Äôs fashion, offering elegant clothing designed to inspire confidence and style.",
    "founder": "Foyer Studio Team",
    "contactPoint": {
      "@type": "ContactPoint",
      "email": "fashion@foyerstudio.in",
      "contactType": "customer support",
      "availableLanguage": ["English"]
    }
  }
  </script>

  <!-- ‚úÖ Structured Data: Local Business -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Foyer Studio",
    "image": "https://foyerstudio.in/images/logo_red.png",
    "url": "https://foyerstudio.in",
    "telephone": "+919037622566",
    "email": "fashion@foyerstudio.in",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Kunjathur, Manjeshwar",
      "addressLocality": "Kasaragod",
      "addressRegion": "Kerala",
      "postalCode": "671323",
      "addressCountry": "IN"
    },
    "openingHours": "Mo-Su 09:00-21:00",
    "priceRange": "‚Çπ‚Çπ",
    "sameAs": [
      "https://www.instagram.com/foyerstudio",
      "https://wa.me/919037622566"
    ],
    "description": "Foyer Studio‚Ñ¢ is a local online boutique in Kerala offering elegant women's clothing. Serving customers in Kasaragod, Manjeshwar, and Kunjathur."
  }
  </script>

  <style>
:root {
  --header-height: 88px;
  --card-anim-delay: 60ms;
}

/* Base reset & global */
html, body {
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
  background: #fefef6;
  color: #731a2f;
  scroll-behavior: smooth;
   max-width: 100%;
  overflow-x: hidden;
}
body {
  padding-top: var(--header-height);
  transition: opacity .25s ease;
  overflow-x: hidden;
}

/* Fixed top banner */
.banner {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: var(--header-height);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  background: #fefef6;
  z-index: 2200;
  border-bottom: 1px solid rgba(0,0,0,0.04);
  padding-top: 6px;
}
.banner-logo {
  height: 46px;
  width: auto;
}
.banner .title {
  font-family: 'Playfair Display', serif;
  font-size: 1.45rem;
  color: #731a2f;
  margin-top: 4px;
  text-align: center;
}

/* Floating Menu Button */
.menu-fab {
  position: fixed;
  top: 10px;
  left: 16px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #fefef6;
  box-shadow: 0 6px 15px rgba(0,0,0,0.12);
  cursor: pointer;
  z-index: 2400;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.25s ease, background 0.25s ease;
}
.menu-fab:hover {
  transform: scale(1.05);
  background: #f9f9f9;
}

/* Bars inside button */
.menu-fab .bar,
.menu-fab .bar::before,
.menu-fab .bar::after {
  content: '';
  display: block;
  width: 24px;
  height: 3px;
  background: #731a2f;
  border-radius: 2px;
  position: relative;
  transition: all 0.4s cubic-bezier(.77,0,.175,1);
}
.menu-fab .bar::before {
  position: absolute;
  top: -8px;
  left: 0;
}
.menu-fab .bar::after {
  position: absolute;
  top: 8px;
  left: 0;
}

/* Morph into X when open */
.menu-fab.open .bar {
  background: transparent;
}
.menu-fab.open .bar::before {
  transform: rotate(45deg);
  top: 0;
}
.menu-fab.open .bar::after {
  transform: rotate(-45deg);
  top: 0;
}

.menu {
  position: fixed;
  top: 0px;
  left: 0;
  width: 280px;
  height: 100vh;
  background: #fefef6;
  box-shadow: 3px 0 10px rgba(0,0,0,0.15);
  padding: 80px 25px 25px; /* top spacing for icon gap */
  transform: translateX(-100%);
  opacity: 0;
  visibility: hidden;
  transition: transform 0.4s ease, opacity 0.4s ease;
  display: flex;
  flex-direction: column;
  gap: 16px;
  z-index: 2300;
}

.menu::before {
  content: "";
  position: absolute;
  top: 70px; /* match top padding exactly */
  left: 0;
  width: 100%;
  height: 1px;
  background: #731a2f;
  opacity: 0.3; /* subtle look */
  pointer-events: none; /* prevent blocking clicks */
}



/* Visible when .show is added */
.menu.show {
  transform: translateX(0);
  opacity: 1;
  visibility: visible;
}

/* Menu links */
.menu a {
  text-decoration: none;
  color: #731a2f;
  font-size: 1.1rem;
  font-weight: 300;
  transition: color 0.2s ease;
}
.menu a:hover {
  color: #b21f32;
}

/* Base link style */
.menu a {
  text-decoration: none;
  color: #731a2f;
  font-size: 1.1rem;
  font-weight: 300;
  opacity: 0;
  transform: translateX(-20px);
  transition: color 0.2s ease;
}

/* Animate links in horizontally (left ‚Üí right) */
.menu.show a {
  animation: fadeSlideInX 0.35s ease forwards;
}

/* Stagger timing for each link */
.menu.show a:nth-child(1) { animation-delay: 0.05s; }
.menu.show a:nth-child(2) { animation-delay: 0.10s; }
.menu.show a:nth-child(3) { animation-delay: 0.15s; }
.menu.show a:nth-child(4) { animation-delay: 0.20s; }
.menu.show a:nth-child(5) { animation-delay: 0.25s; }
.menu.show a:nth-child(6) { animation-delay: 0.30s; }
.menu.show a:nth-child(7) { animation-delay: 0.35s; }
.menu.show a:nth-child(8) { animation-delay: 0.40s; }

/* Keyframes: soft fade + slide horizontally */
@keyframes fadeSlideInX {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* --- Ensure Horizontal Animation on All Devices --- */
@media (max-width: 768px) {
  .menu {
    width: 80%;
    padding: 80px 20px;
  }

  .menu a {
    font-size: 1rem;
    transform: translateX(-20px); /* explicitly set horizontal base */
  }

  .menu.show a {
    animation: fadeSlideInX 0.4s ease forwards;
    transform-origin: left center; /* force horizontal flow */
  }

  /* Proper staggered animation sequence */
  .menu.show a:nth-child(1) { animation-delay: 0.05s; }
  .menu.show a:nth-child(2) { animation-delay: 0.10s; }
  .menu.show a:nth-child(3) { animation-delay: 0.15s; }
  .menu.show a:nth-child(4) { animation-delay: 0.20s; }
  .menu.show a:nth-child(5) { animation-delay: 0.25s; }
  .menu.show a:nth-child(6) { animation-delay: 0.30s; }
  .menu.show a:nth-child(7) { animation-delay: 0.35s; }
  .menu.show a:nth-child(8) { animation-delay: 0.40s; }

  /* Reaffirm keyframes direction */
  @keyframes fadeSlideInX {
    from {
      opacity: 0;
      transform: translateX(-20px); /* always from left */
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
}




/* Nav */
.nav {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px 14px;
  background: #fefef6;
  position: relative;
  z-index: 1200;
}
.nav button {
  background: transparent;
  border: 0;
  color: #731a2f;
  font-size: 16px;
  font-weight: 500;
  padding: 8px 16px;
  border-radius: 30px;
  cursor: pointer;
  transition: all .22s ease;
}
.nav button:hover, .nav button.active {
  background: #731a2f;
  color: #fefef6;
}

/* Hero / offer banner */
.offer-banner {
  width: 100%;
  max-height: 400px;      /* cap height on desktop */
  min-height: 200px;      /* ensures visibility if images fail */
  border: 2px solid #731a2f;
  overflow: hidden;
  position: relative;
  border-radius: 8px;
}

.slides {
  width: 100%;
  height: 100%;
  display: flex;          /* keep images in flex for easier scaling */
  position: relative;
}

.slide {
  flex-shrink: 0;
  width: 100%;
  height: auto;
  object-fit: contain;    /* ensures entire image is visible, no crop */
  display: none;          /* hide initially */
}

.slide.active {
  display: block;         /* only active slide is visible */
}

.dots {
  position: absolute;
  bottom: 10px;
  width: 100%;
  text-align: center;
}

.dot {
  display: inline-block;
  width: 12px;
  height: 12px;
  margin: 0 5px;
  background: rgba(255,255,255,0.5);
  border-radius: 50%;
  cursor: pointer;
}

.dot.active {
  background: rgba(255,255,255,1);
}

@media screen and (max-width: 600px) {
  .offer-banner {
    width: 100%;
    height: auto;          /* match image height */
    max-height: none;      /* remove fixed limit */
    min-height: unset;     /* remove unnecessary min height */
    border: 2px solid #731a2f;
    border-radius: 8px;
    overflow: hidden;
  }

  .slides {
    display: block;        /* stack images properly on mobile */
  }

  .slide {
    width: 100%;
    height: auto;          /* auto height based on image ratio */
    display: none;
  }

  .slide.active {
    display: block;
  }
}


/* Main container */
.main {
  max-width: 1180px;
  margin: 20px auto;
  padding: 0 18px;
}

/* Tab content */
.tabcontent {
  display: none;
  opacity: 0;
  transform: translateY(8px);
  transition: all .36s cubic-bezier(.22,.9,.2,1);
}
.tabcontent.active {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

/* Header wrapper */
.header-wrapper h1 {
  font-family: 'Playfair Display', serif;
  font-size: 1.7rem;
  text-align: center;
  margin: 12px 0 22px;
  color: #731a2f;
}

/* Search box */
.search-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin-bottom: 10px;
}
.search-container input,
.search-container select,
.search-container button {
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  color: #731a2f;
  background: #fefef6;
}
.search-container button {
  background: #731a2f;
  color: #fefef6;
  border: 0;
  cursor: pointer;
}

/* Row grouping (Size+Color, Min+Max) */
.search-row {
  display: flex;
  gap: 10px;
}

/* Inputs inside rows flex equally */
.search-row select,
.search-row input {
  flex: 1;
}



/* Mobile adjustments */
@media (max-width: 480px) {
  .search-container {
    flex-direction: column;
    gap: 10px;     /* vertical spacing */
    margin: 0 5px; /* 5px left & right margin for whole container */
  }

  /* Full-width on small screens */
  .search-container input,
  .search-container select,
  .search-container button {
    width: calc(100% - 10px);
    margin: 0 5px;
  }

  /* Row grouping with margins */
  .search-row {
    margin: 0 5px;
  }
}

/* Remove default number input arrows */
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input[type=number] {
  -moz-appearance: textfield;
  appearance: textfield;
  text-align: center;
  padding-right: 25px;
  position: relative;
}

/* Responsive layout */
@media (max-width: 600px) {
  .search-container {
    flex-direction: column;
    align-items: stretch;
  }

  .search-container input,
  .search-container select {
    width: 100%;
    margin-left: 0;
  }

  .search-container button {
    width: auto;
    padding: 4px 8px;
    font-size: 12px;
    align-self: flex-start; /* Prevent full-width button */
    margin-left: 0;
    margin-bottom: 6px;
  }
}

/* Add spacing below last button */
.search-container .search-row.full:last-child {
  margin-bottom: 5px; /* space after clear button row */
}




/* Product grid */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 22px;
}
.product-card {
  background: #fefef6;
  border-radius: 10px;
  overflow: hidden;
  text-align: center;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  transition: transform .22s ease, box-shadow .22s ease;
  padding-bottom: 12px;
  opacity: 0;
  transform: translateY(10px);
  animation: cardFade .36s ease forwards;
  animation-delay: calc(var(--i) * var(--card-anim-delay));
}
.product-card:hover {
  transform: translateY(-10px) scale(1.03);
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}
@keyframes cardFade { to { opacity: 1; transform: translateY(0); } }

.product-card img {
  width: 100%;
  height: auto;
  object-fit: cover;
}
.product-name {
  font-weight: 500;
  margin-top: 10px;
  color: #731a2f;
  font-size: 15px;
  padding: 0 8px;
}
.product-price {
  color: #731a2f;
  font-size: 14px;
  margin-top: 6px;
  margin-bottom: 8px;
}

@media screen and (max-width: 600px) {
  .grid {
    grid-template-columns: repeat(2, 1fr); /* Two per row */
    gap: 10px; /* Slightly tighter grid for small screens */
  }

  .product-card {
    border-radius: 10px;
    overflow: hidden;
    padding-bottom: 8px;
  }

  .product-card img {
    width: 100%;
    height: auto;           /* uniform height for all images */
    object-fit: cover;       /* fills the area, minor crop */
    border-radius: 10px;     /* rounded corners */
    display: block;
  }

  .product-name,
  .product-price {
    font-size: 13px;
  }
}



.loader {
  width: 100%;
  height: 3px;
  display: none;
  background: transparent;
  position: relative;
}
.loader .bar {
  height: 100%;
  width: 0;
  background: #731a2f;
  animation: loadingAnim 5s linear infinite;
}
@keyframes loadingAnim {
  0% { width: 0; margin-left: 0 }
  50% { width: 60%; margin-left: 20% }
  100% { width: 0; margin-left: 100% }
}

.no-products { text-align: center; color: #999; margin: 18px 0; }
.back-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  border-radius: 30px;
  border: 1.6px solid #731a2f;
  background: #fefef6;
  color: #731a2f;
  font-weight: 500;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}

/* Add a left arrow before text */
.back-btn::before {
  content: "‚Üê";
  font-size: 1rem;
  transition: transform 0.25s ease;
}

/* Hover: reverse colors + slight arrow movement */
.back-btn:hover {
  background: #731a2f;
  color: #fefef6;
  border-color: #731a2f;
  transform: translateX(-2px);
}
.back-btn:hover::before {
  transform: translateX(-3px);
}


.footer-credit a, .footer-credit p {
  font-size: 14px;
  text-decoration: none;
  color: #731a2f;
  transition: color 0.2s;
}

/* Animation for page enter */
.view-enter { animation: viewEnter .36s ease forwards; }
@keyframes viewEnter {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: none; }
}

/* ‚úÖ FULL MOBILE RESPONSIVENESS */
@media (max-width: 1024px) {
  .banner .title { font-size: 1.25rem; }
  .nav { flex-wrap: wrap; }
}

@media (max-width: 768px) {
  :root { --header-height: 72px; }
  .banner-logo { height: 38px; }
  .menu { width: 200px; }
  .banner .title { font-size: 1.1rem; }
  .nav button { font-size: 14px; padding: 6px 12px; }
  .header-wrapper h1 { font-size: 1.4rem; }
}

@media (max-width: 480px) {
  .banner { height: var(--header-height); padding-top: 4px; }
  .banner-logo { height: 32px; }
  .banner .title { font-size: 1rem; }
  .nav { gap: 6px; padding: 8px; }
  .nav button { font-size: 13px; padding: 6px 10px; }
}

/* Product Card Container */


/* Image Container */
.product-image {
  position: relative;
  width: 100%;
  overflow: hidden;
}

.product-image img {
  width: 100%;
  height: auto;
  display: block;
  border-bottom: 1px solid #eee;
}

/* Cart Button Positioned Over Image */
.cart-btn {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background: #ccc;
  color: #000;
  border: none;
  border-radius: 50%;
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  transform: scale(0.9);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

/* Show on hover for desktop */
.product-image:hover .cart-btn {
  opacity: 1;
  transform: scale(1);
}

/* Always show cart button on small screens (mobile) */
@media (max-width: 768px) {
  .cart-btn {
    opacity: 1;
    transform: scale(1);
  }
}


.cart-btn i {
  font-size: 16px;
}

/* Product Info */
.product-name {
  font-size: 14px;
  font-weight: 500;
  color: #333;
  margin: 10px 0 5px;
  text-align: center;
}

.product-price {
  font-size: 14px;
  font-weight: 600;
  color: #000;
  margin-bottom: 10px;
}

 /* === Category Products View === */
  

  .header-wrapper h1 {
    font-size: 20px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 20px;
  }

  .search-container {
    background: #fafafa;
  }

  .search-row.full {
    flex-direction: column;
  }

  #clearCategoryFilters {
    background: #731a2f;
    color: #fefef6;
    font-weight: 500;
    cursor: pointer;
  }


  .no-products {
    text-align: center;
    font-size: 14px;
    color: #777;
    margin-top: 20px;
  }

  /* === Popup Overlay === */
  .popup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(3px);
  }

  .popup {
    background: #fff;
    width: 90%;
    max-width: 380px;
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    padding: 24px 20px 30px;
    position: relative;
    text-align: center;
    animation: popupIn 0.3s ease-out;
  }

  @keyframes popupIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .close-btn {
    position: absolute;
    top: 12px;
    right: 14px;
    background: transparent;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #333;
    transition: transform 0.2s ease;
  }

  .close-btn:hover {
    transform: rotate(90deg);
  }

  .popup h3 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #111;
  }

  .size-options {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 24px;
  }

  .size-options button {
    min-width: 60px;
    padding: 10px 0;
    border: 1.5px solid #ccc;
    background: #fff;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .size-options button:hover {
    border-color: #000;
  }

  .size-options button.selected {
    background: #000;
    color: #fff;
    border-color: #000;
  }

  .confirm-btn {
    background: #000;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 12px 0;
    width: 100%;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: 0.3px;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .confirm-btn:hover {
    background: #222;
  }

  @media (max-width: 480px) {
    .popup {
      width: 80%;
      padding: 20px 16px 24px;
    }
    .size-options button {
      min-width: 50px;
      font-size: 13px;
    }
  }

  .cart-btn:disabled {
  background: #999 !important;
  cursor: not-allowed;
  opacity: 0.6;
}

.size-options button {
  -webkit-tap-highlight-color: transparent; /* remove blue flash */
  outline: none; /* remove focus ring */
}

.size-options button:focus,
.size-options button:active {
  background: #000;
  color: #fff;
  border-color: #000;
  outline: none;
  box-shadow: none;
}

.fly-image {
  position: fixed;
  left: 50%;
  top: 50%;
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 12px;
  z-index: 9999;
  pointer-events: none;
  box-shadow: 0 8px 18px rgba(0,0,0,0.3);
  transform: translate(-50%, -50%);
}

.cart-pulse {
  animation: cartPulse 5s ease;
}

@keyframes cartPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}




</style>

</head>
<body>

 <!-- Menu Icon -->
<div class="menu-fab" id="menuIcon" onclick="toggleMenu()" role="button" aria-label="Toggle menu">
  <div class="bar"></div>
</div>

<!-- Left Sliding Menu -->
<nav id="menu" class="menu" aria-hidden="true">
  <a href="#" onclick="openTabFromMenu('shopping'); return false;" style="--i:0">Fashion</a>
  <a href="#" onclick="openTabFromMenu('fragrance'); return false;" style="--i:1">Fragrance</a>
  <a href="#" onclick="openCategoryView(); return false;" style="--i:2">Category</a>
  <a href="TC.html" style="--i:3">Terms & Conditions</a>
  <a href="privacy-policy.html" style="--i:4">Privacy Policy</a>
  <a href="shipping-policy.html" style="--i:3">Shipping Policy</a>
  <a href="return-policy.html" style="--i:5">Return Policy</a>
  <a href="https://foyerstudio.track123.com/?nums=" style="--i:6">Track Your Order</a>
</nav>



  <!-- Fixed top banner (logo+title) -->
  <header class="banner" role="banner">
    <img src="images/logo_red.png" alt="Foyer Studio Logo" class="banner-logo" />
    <div class="title">Foyer Studio</div>
  </header>

  <!-- navigation (scrolls under banner) -->
  <div class="nav" id="topNav">
    <button id="tab-category-nav" class="tablink active" onclick="openCategoryView();">Home</button>
    <button id="tab-shopping" class="tablink" onclick="openTab(event,'shopping')">Fashion</button>
    <button id="tab-fragrance" class="tablink" onclick="openTab(event,'fragrance')">Fragrance</button>
    <button id="cartTab" class="tablink" onclick="goToCart()">Cart</button>
  </div>

 <div class="offer-banner">
  <div class="slides">
    <img src="images/pakistani.jpg" class="slide active" alt="Offer 1">
    <img src="images/fragrance.jpg" class="slide" alt="Offer 3">
  </div>
  <div class="dots">
    <span class="dot active" data-index="0"></span>
    <span class="dot" data-index="1"></span>
  </div>
</div>

  <div id="loader" class="loader"><div class="bar"></div></div>

  <main class="main" role="main">
    <!-- Category view (cards) -->
    <section id="categoryView" style="display:none;">
      <div class="header-wrapper"><h1>Categories</h1></div>
      <div id="categoryGrid" class="grid"></div>
      <div id="categoryNoProducts" class="no-products" style="display:none;">No categories available.</div>
    </section>

    <!-- Category products view (shows after clicking a category) -->
    <section id="categoryProductsView" style="display:none;">
  <div class="header-wrapper"><h1 id="categoryProductsTitle">Category</h1></div>
  <div class="search-container" id="categoryFilters">
  <div class="search-row full">
    <input type="text" id="searchCategory" placeholder="Search product name..." />
  </div>

  <div class="search-row">
    <select id="filterCategorySize"><option value="">All Sizes</option></select>
    <select id="filterCategoryColor"><option value="">All Colors</option></select>
  </div>

  <div class="search-row">
    <input type="number" id="categoryPriceMin" placeholder="Min Price" min="0" />
    <input type="number" id="categoryPriceMax" placeholder="Max Price" min="0" />
  </div>

  <div class="search-row">
    <button onclick="showCategoryCards()">Back</button>
    <button id="clearCategoryFilters">Clear</button>
  </div>
</div>

  <div id="categoryProductsGrid" class="grid"></div>
  <div id="categoryProductsNo" class="no-products" style="display:none;">No products in this category.</div>
</section>

<div id="sizePopup" class="popup-overlay" style="display:none;">
  <div class="popup">
    <button id="closePopup" class="close-btn"><i class="fas fa-times"></i></button>
    <h3>Size Options Available</h3>
    <div id="sizeOptions" class="size-options"></div>
    <button id="confirmSizeBtn" class="confirm-btn">Add to Cart</button>
  </div>
</div>

<div id="fragrance" class="tabcontent">
  <div class="header-wrapper"><h1>Fragrance</h1></div>

  <div class="search-container">
    <!-- Search input -->
    <div class="search-row full">
      <input type="text" id="searchFragrance" placeholder="Search product...">
    </div>

    <!-- Size only (no color) -->
    <div class="search-row full">
   <select id="filterFragranceSize">
  <option value="">All Sizes</option>
  <option value="50 ml">50 ml</option>
  <option value="100 ml">100 ml</option>
</select>
</div>

    <!-- Min + Max side by side -->
    <div class="search-row">
      <input type="number" id="fragranceMinPrice" placeholder="Min Price" min="0">
      <input type="number" id="fragranceMaxPrice" placeholder="Max Price" min="0">
    </div>

    <!-- Clear button -->
    <div class="search-row full">
      <button id="clearFragrance">Clear</button>
    </div>
  </div>


<div id="fragranceGrid"></div>
<div id="fragranceNoProducts" class="no-products" style="display:none;">
  No match found.
</div>


<div id="fragranceGrid" class="product-grid"></div>
</div>

   


   

    <!-- Shopping (Fashion) tab -->
    <section id="shopping" class="tabcontent">
      <div class="header-wrapper"><h1>All Products</h1></div>

      <div class="search-container">
        <div class="search-row full">
        <input type="text" id="searchShopping" placeholder="Search product..." />
      </div>
      <div class="search-row">
        <select id="filterSize"><option value="">All Sizes</option></select>
        <select id="filterColor"><option value="">All Colors</option></select>
      </div>
      <div class="search-row">
        <!-- category filter removed -->
        <input type="number" id="priceMin" placeholder="Min Price" min="0" />
        <input type="number" id="priceMax" placeholder="Max Price" min="0" />
      </div>
      <div class="search-row full">
        <button id="clearShopping">Clear</button>
      </div>
      </div>

      <div id="shoppingGrid" class="grid"></div>
      <div id="shoppingNoProducts" class="no-products" style="display:none;">No match found.</div>
    </section>
  </main>

  <!-- Elfsight Google Reviews -->
<script src="https://elfsightcdn.com/platform.js" async></script>
<div class="elfsight-app-12c65bc7-9246-4ffa-9e19-3775ffd32f2d" data-elfsight-app-lazy style="margin-top: 20px;"></div>

  <footer class="site-footer" style="text-align:center; padding:26px 18px; border-top:3px solid #731a2f; background:#fefef6;">
    <div style="margin-bottom:12px;"><img src="images/logo_red.png" alt="Foyer Studio" style="width:100px;"></div>
    <div class="footer-social" style="margin-bottom:12px;">
      <a href="https://wa.me/919037622566" target="_blank"><img src="images/whatsapp.png" alt="WhatsApp" style="width:28px; margin:0 8px;"></a>
      <a href="https://instagram.com/foyerstudio" target="_blank"><img src="images/insta.png" alt="Instagram" style="width:28px; margin:0 8px;"></a>
      <a href="mailto:fashion@foyerstudio.in"><img src="images/mail.png" alt="Email" style="width:28px; margin:0 8px;"></a>
    </div>
    
     <!-- Footer Credits -->
  <div class="footer-credit">
    <p>
      <a href="TC.html">Terms & Conditions</a>
    </p>
    <p>
      <a href="privacy-policy.html">Privacy Policy</a> ¬∑
      <a href="return-policy.html">Return Policy</a> ¬∑
      <a href="shipping-policy.html">Shipping Policy</a>
    </p>
    <p>¬© 2025 Foyer Studio‚Ñ¢ ‚Äî All Rights Reserved.</p>
  </div>
</footer>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>

   function toggleMenu() {
  const icon = document.getElementById('menuIcon');
  const menu = document.getElementById('menu');
  icon.classList.toggle('open');
  menu.classList.toggle('show');
}


    // Firebase config (unchanged)
    const firebaseConfig = {
      apiKey: "AIzaSyAjlHBB46moYAuus9aNb_ZYD_C-duqf7lM",
      authDomain: "foyerstudio-6fa35.firebaseapp.com",
      projectId: "foyerstudio-6fa35",
      storageBucket: "foyerstudio-6fa35.firebasestorage.app",
      messagingSenderId: "406213917569",
      appId: "1:406213917569:web:aba9885f5815cba0f18680",
      measurementId: "G-DSFEHX0LTM"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // fetch inventory - unchanged
    async function fetchInventoryFromFirestore(){
      try {
        const snapshot = await db.collection("Inventory").get();
        const inventory = [];
        snapshot.forEach(doc => inventory.push({ code: doc.id, ...doc.data() }));
        return inventory;
      } catch (err) { console.error("Error fetching inventory from Firestore:", err); return []; }
    }

    // Size codes and helper (unchanged)
    const SIZE_CODES = ["XXXS","0XXS","00XS","000S","000M","000L","00XL","0XXL","XXXL","0000","0100","0050"];
    function getBaseCode(code = "") { for (let s of SIZE_CODES) if (code.endsWith(s)) return code.slice(0, -s.length); return code; }

    const apiProduct = "https://script.google.com/macros/s/AKfycbwSgPt1bqa11wXfJCzQ1SKxFLGVhVHyr6icSuO6EYmiQgd1t_sSgRrReivvUhKHKdYAmw/exec?type=product";
    const apiInventory = "https://script.google.com/macros/s/AKfycbwSgPt1bqa11wXfJCzQ1SKxFLGVhVHyr6icSuO6EYmiQgd1t_sSgRrReivvUhKHKdYAmw/exec?type=inventory"

    function showLoader(){ document.getElementById('loader').style.display = 'block'; }
    function hideLoader(){ document.getElementById('loader').style.display = 'none'; }

    // openTab - ensures only requested tab visible and triggers load/filter setups
    function openTab(evt, tabName){
      Array.from(document.getElementsByClassName('tabcontent')).forEach(t=>{ t.classList.remove('active'); t.style.display='none'; t.classList.remove('view-enter'); });
      Array.from(document.getElementsByClassName('tablink')).forEach(b=>b.classList.remove('active'));
      const el = document.getElementById(tabName);
      if (el){ el.classList.add('active'); el.style.display='block'; el.classList.add('view-enter'); }
      if (evt && evt.currentTarget) evt.currentTarget.classList.add('active');

      // hide category views
      document.getElementById('categoryView').style.display = 'none';
      document.getElementById('categoryProductsView').style.display = 'none';

      // load the relevant grids & filters
      if (tabName === 'shopping') {
        const applyFilters = setupShoppingFiltersAndSearch();
        loadShoppingGrid(()=>{ populateFiltersFromLocalJSON(()=> restoreFiltersAndApply(applyFilters)); });
      }
      if (tabName === 'fragrance') {
        const applyFilters = setupFragranceFiltersAndSearch();
        loadFragranceGrid(()=>{ restoreFragranceFiltersAndApply(applyFilters); });
      }
      // scroll below banner for user
      window.scrollTo({ top: (parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-height')) || 88) + 8, behavior:'smooth' });
    }

    // helper used by menu to open fragrance (no event)
   function openTabFromMenu(tab) {
  // remove active class from all tab buttons
  Array.from(document.getElementsByClassName('tablink')).forEach(b => b.classList.remove('active'));

  // choose correct button based on tab name
  let btn;
  if (tab === 'fragrance') {
    btn = document.getElementById('tab-fragrance');
  } else if (tab === 'category') {
    btn = document.getElementById('tab-category-nav');
  } else if (tab === 'shopping') {
    btn = document.getElementById('tab-shopping'); // fashion tab
  }

  // activate selected button
  if (btn) btn.classList.add('active');

  // open the correct tab or category view
  if (tab === 'category') {
    openCategoryView();
  } else if (tab === 'shopping') {
    openTab({ currentTarget: btn }, 'shopping'); // fashion tab
  } else {
    openTab({ currentTarget: btn }, tab);
  }

  // close the menu if it‚Äôs open
  const menu = document.getElementById('menu');
  const icon = document.getElementById('menuIcon');
  if (menu && menu.classList.contains('show')) {
    menu.classList.remove('show');
    if (icon) icon.classList.remove('open');
    menu.setAttribute('aria-hidden', 'true');
  }
}



    // Global arrays
    let shoppingProducts = [];
    let fragranceProducts = [];
    let allProductsCache = null;

    // Populate filters (size/colors/category JSON) - safe if category select removed
    function populateFiltersFromLocalJSON(callback){
      const sizeFilter = document.getElementById("filterSize");
      const colorFilter = document.getElementById("filterColor");
      const categoryFilter = document.getElementById("filterCategory");
      Promise.all([
        fetch("./JSON/size.json").then(r=>r.json()),
        fetch("./JSON/colors.json").then(r=>r.json()),
        fetch("./JSON/category.json").then(r=>r.json())
      ]).then(([sizes, colors, categories])=>{
        if (sizeFilter){
          sizeFilter.querySelectorAll('option:not(:first-child)').forEach(o=>o.remove());
          sizes.forEach(item=>{
            if (item.size && !String(item.size).toLowerCase().includes("ml")){
              let sizeValue = item.size;
              if (typeof sizeValue === 'number') sizeValue = sizeValue.toString().padStart(4,'0');
              const opt = document.createElement('option'); opt.value = sizeValue; opt.textContent = sizeValue; sizeFilter.appendChild(opt);
            }
          });
        }
        if (colorFilter){
          colorFilter.querySelectorAll('option:not(:first-child)').forEach(o=>o.remove());
          colors.forEach(item=>{
            if (item.color && item.color.toLowerCase() !== "perfume"){
              const opt = document.createElement('option'); opt.value = item.color; opt.textContent = item.color; colorFilter.appendChild(opt);
            }
          });
        }
        if (categoryFilter){
          categoryFilter.querySelectorAll('option:not(:first-child)').forEach(o=>o.remove());
          categories.forEach(item=>{
            if (item.type && !item.type.toLowerCase().includes("eau de")){
              const opt = document.createElement('option'); opt.value = item.type; opt.textContent = item.type; categoryFilter.appendChild(opt);
            }
          });
        }
        if (callback) callback();
      }).catch(err=>{ console.error("Error fetching filters:", err); if (callback) callback(); });
    }

    // ---------------- Shopping grid (fashion) ----------------
    function loadShoppingGrid(callbackAfterLoad){
      showLoader();
      Promise.all([ fetch('./JSON/products.json').then(r=>r.json()), fetchInventoryFromFirestore() ])
      .then(([products, inventory])=>{
        hideLoader();
        if (!Array.isArray(products) || !Array.isArray(inventory)) return;

        // cache all products for category usage
        allProductsCache = products;

        const inventoryMap = {};
        inventory.forEach(item => inventoryMap[item.code] = Number(item.inStock) || 0);

        shoppingProducts = products.filter(p=>{
          const code = (p.code||"").toLowerCase();
          return inventoryMap[p.code] > 0 && !code.includes("pf"); // fashion exclude pf
        });
        shoppingProducts.reverse();

        const savedFilters = {
          search: (localStorage.getItem("shoppingSearch")||"").toLowerCase(),
          size: (localStorage.getItem("shoppingSize")||"").toLowerCase(),
          color: (localStorage.getItem("shoppingColor")||"").toLowerCase(),
          minPrice: localStorage.getItem("shoppingMinPrice") || "",
          maxPrice: localStorage.getItem("shoppingMaxPrice") || ""
        };

        if (savedFilters.search.includes("pf")) { renderShoppingGrid([]); if (callbackAfterLoad) callbackAfterLoad(); return; }

        const filteredProducts = shoppingProducts.filter(p=>{
          const cardSize = (p.size||"").toLowerCase();
          const cardColor = (p.color||"").toLowerCase();
          const price = parseFloat(p.sellingPrice) || 0;
          const sizeMatch = !savedFilters.size || cardSize === savedFilters.size;
          const colorMatch = !savedFilters.color || cardColor === savedFilters.color;
          const priceMatch = price >= (parseFloat(savedFilters.minPrice) || 0) && price <= (parseFloat(savedFilters.maxPrice) || Infinity);
          const searchMatch = (p.name||"").toLowerCase().includes(savedFilters.search) || (p.code||"").toLowerCase().includes(savedFilters.search) || (p.sellingPrice||"").toString().includes(savedFilters.search);
          return sizeMatch && colorMatch && priceMatch && searchMatch;
        });

        // deduplicate unless size applied
        let deduped=[]; let seenBase=new Set();
        if (!savedFilters.size){
          filteredProducts.forEach(p=>{ const base=getBaseCode(p.code); if(!seenBase.has(base)){ seenBase.add(base); deduped.push(p); }});
        } else deduped = filteredProducts;

        renderShoppingGrid(deduped);
        if (callbackAfterLoad) callbackAfterLoad();
      }).catch(err=>{ hideLoader(); console.error("Error loading shopping grid:", err); });
    }

    function renderShoppingGrid(products){
      const grid = document.getElementById("shoppingGrid");
      const existing = grid.querySelectorAll('.product-card'); existing.forEach(c=>c.style.display='none');

      products.forEach((p, idx)=>{
        let card = grid.querySelector(`.product-card[data-code="${p.code}"]`);
        if (!card){
          card = document.createElement('div'); card.className='product-card'; card.dataset.code = p.code || "";
          card.dataset.name = p.name || ""; card.dataset.price = p.sellingPrice || ""; card.dataset.size = p.size || ""; card.dataset.color = p.color || ""; card.dataset.category = p.type || "";

          const img = document.createElement('img'); img.loading='lazy';
          const driveFileId = p.image1;
          img.src = driveFileId ? `https://drive.google.com/uc?export=view&id=${driveFileId}` : `images/products/${p.code}/1.jpg`;
          img.alt = p.name || "Product";

          const name = document.createElement('div'); name.className='product-name'; name.textContent = p.name || "";
          const price = document.createElement('div'); price.className='product-price'; price.textContent = p.sellingPrice ? `‚Çπ${p.sellingPrice}` : "";

          card.appendChild(img);
          img.onload = ()=>{ if (!card.contains(name)) card.appendChild(name); if (!card.contains(price)) card.appendChild(price); };
          img.onerror = ()=>{ if (!card.contains(name)) card.appendChild(name); if (!card.contains(price)) card.appendChild(price); };

          card.addEventListener('click', ()=>{ 
  sessionStorage.setItem('fromTab','shopping');  // üëà remember current tab
  window.location.href = `shopping-details.html?code=${encodeURIComponent(p.code)}`;
});


          grid.appendChild(card);
        }
        // set stagger index variable for CSS animation
        card.style.setProperty('--i', idx);
        card.style.display = 'block';
      });
      hideLoader();
    }

    // ---------------- Fragrance ----------------
    function loadFragranceGrid(callbackAfterLoad){
      showLoader();
      Promise.all([ fetch('./JSON/products.json').then(r=>r.json()), fetchInventoryFromFirestore() ])
      .then(([products, inventory])=>{
        hideLoader();
        if (!Array.isArray(products) || !Array.isArray(inventory)) return;

        allProductsCache = products;
        const inventoryMap = {}; inventory.forEach(i=>inventoryMap[i.code] = Number(i.inStock) || 0);

        fragranceProducts = products.filter(p=>{
          const code = (p.code||"").toLowerCase();
          return inventoryMap[p.code] > 0 && code.includes("pf");
        });
        fragranceProducts.reverse();

        const savedFilters = {
          search: localStorage.getItem("searchFragrance") || "",
          size: localStorage.getItem("filterFragranceSize") || "",
          minPrice: localStorage.getItem("fragranceMinPrice") || "",
          maxPrice: localStorage.getItem("fragranceMaxPrice") || ""
        };

        const filteredProducts = fragranceProducts.filter(p=>{
          const cardSize = (p.size||"").toLowerCase();
          const price = parseFloat(p.sellingPrice) || 0;
          const searchText = savedFilters.search.toLowerCase();
          const sizeMatch = !savedFilters.size || cardSize === savedFilters.size.toLowerCase();
          const priceMatch = price >= (parseFloat(savedFilters.minPrice) || 0) && price <= (parseFloat(savedFilters.maxPrice) || Infinity);
          const searchMatch = (p.name||"").toLowerCase().includes(searchText) || (p.code||"").toLowerCase().includes(searchText) || (p.sellingPrice||"").toString().includes(searchText);
          return sizeMatch && priceMatch && searchMatch;
        });

        renderFragranceGrid(filteredProducts);
        if (callbackAfterLoad) callbackAfterLoad();
      }).catch(err=>{ hideLoader(); console.error("Error loading fragrance grid:", err); });
    }

    function renderFragranceGrid(products){
      const grid = document.getElementById("fragranceGrid");
      grid.querySelectorAll('.product-card').forEach(c=>c.style.display='none');

      products.forEach((p, idx)=>{
        let card = grid.querySelector(`.product-card[data-code="${p.code}"]`);
        if (!card){
          card = document.createElement('div'); card.className='product-card'; card.dataset.code = p.code || "";
          const img = document.createElement('img'); img.loading='lazy';
          const driveFileId = p.image1;
          img.src = driveFileId ? `https://drive.google.com/uc?export=view&id=${driveFileId}` : `images/products/${p.code}/1.jpg`;
          img.alt = p.name || "Product";
          const name = document.createElement('div'); name.className='product-name'; name.textContent = p.name || "";
          const price = document.createElement('div'); price.className='product-price'; price.textContent = p.sellingPrice ? `‚Çπ${p.sellingPrice}` : "";
          card.appendChild(img);
          img.onload = ()=>{ if (!card.contains(name)) card.appendChild(name); if (!card.contains(price)) card.appendChild(price); };
          img.onerror = ()=>{ if (!card.contains(name)) card.appendChild(name); if (!card.contains(price)) card.appendChild(price); };
          card.addEventListener('click', ()=>{ window.location.href = `fragrance-details.html?code=${encodeURIComponent(p.code)}`; });
          grid.appendChild(card);
        }
        card.style.setProperty('--i', idx);
        card.style.display = 'block';
      });
      hideLoader();
    }

    // ---------------- Category view logic ----------------
   async function showCategoryCards() {
  // hide tabs
  document.querySelectorAll('.tabcontent').forEach(t => {
    t.classList.remove('active');
    t.style.display = 'none';
  });
  document.getElementById('categoryProductsView').style.display = 'none';
  const cv = document.getElementById('categoryView');
  cv.style.display = 'block';
  cv.classList.add('view-enter');

  const catGrid = document.getElementById('categoryGrid');
  catGrid.innerHTML = '';

  showLoader();
  let products = allProductsCache;
  const inventory = await fetchInventoryFromFirestore();
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  if (!Array.isArray(products)) {
    try {
      products = await fetch('./JSON/products.json').then(r => r.json());
      allProductsCache = products;
    } catch (e) { products = []; }
  }

  // --- Collect categories from tags
  const catMap = new Map(); // key: category name, value: sample product
  products.forEach(p => {
    if (invMap[p.code] > 0 && p.tags) {
      p.tags.split(',').map(tag => tag.trim()).forEach(tag => {
        if (!catMap.has(tag)) catMap.set(tag, p);
      });
    }
  });

  // --- Sort categories: New Arrivals first, Premium second, then alphabetical
  const sortedCategories = Array.from(catMap.keys()).sort((a, b) => {
    if (a === 'New Arrivals') return -1;
    if (b === 'New Arrivals') return 1;
    if (a.includes('Premium') && !b.includes('Premium')) return -1;
    if (!a.includes('Premium') && b.includes('Premium')) return 1;
    return a.localeCompare(b);
  });

  if (sortedCategories.length === 0) {
    document.getElementById('categoryNoProducts').style.display = 'block';
  } else {
    document.getElementById('categoryNoProducts').style.display = 'none';
    sortedCategories.forEach((tag, i) => {
      const sampleProd = catMap.get(tag);
      const card = document.createElement('div');
      card.className = 'product-card category-card';
      card.dataset.category = tag;

      const img = document.createElement('img');
      img.loading = 'lazy';
      const driveFileId = sampleProd.image1;
      img.src = driveFileId
        ? `https://drive.google.com/uc?export=view&id=${driveFileId}`
        : `images/products/${sampleProd.code}/1.jpg`;
      img.alt = tag;

      const label = document.createElement('div');
      label.className = 'product-name';
      label.textContent = tag;

      card.appendChild(img);
      card.appendChild(label);
      card.style.setProperty('--i', i);
      card.addEventListener('click', () => { showProductsForCategory(tag); });
      catGrid.appendChild(card);
    });
  }

  hideLoader();
  document.getElementById('shopping').style.display = 'none';
  document.getElementById('fragrance').style.display = 'none';
  window.scrollTo({
    top: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-height')) + 10,
    behavior: 'smooth'
  });
}


  async function showProductsForCategory(categoryName) {
  document.getElementById('categoryView').style.display = 'none';
  const cpv = document.getElementById('categoryProductsView');
  cpv.style.display = 'block';
  cpv.classList.add('view-enter');
  document.getElementById('categoryProductsTitle').textContent = categoryName;

  showLoader();

  let products = allProductsCache;
  const inventory = await fetchInventoryFromFirestore();
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  if (!Array.isArray(products)) {
    try {
      products = await fetch('./JSON/products.json').then(r => r.json());
      allProductsCache = products;
    } catch (e) { products = []; }
  }

  // --- Filter products by category tag and in-stock
  const categoryProducts = products.filter(p =>
    invMap[p.code] > 0 &&
    p.tags &&
    p.tags.split(',').map(t => t.trim()).includes(categoryName)
  );

  // --- Deduplicate by base product code
  const dedupedProducts = [];
  const seenBase = new Set();
  categoryProducts.forEach(p => {
    const base = getBaseCode(p.code);
    if (!seenBase.has(base)) {
      seenBase.add(base);
      dedupedProducts.push(p);
    }
  });

  renderProductsToGrid(dedupedProducts, document.getElementById('categoryProductsGrid'), 'category', categoryName);
  initCartButtons();
  updateAllCartButtons();
  document.getElementById('categoryProductsNo').style.display = dedupedProducts.length === 0 ? 'block' : 'none';

  hideLoader();

  window.scrollTo({
    top: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-height')) + 10,
    behavior: 'smooth'
  });

  // --- Setup filters/search using categoryProducts
  setupCategoryFiltersAndSearch(categoryProducts, categoryName);

  // --- Product click handling (same as before)
  const cards = document.querySelectorAll('#categoryProductsGrid .product-card');
  cards.forEach(card => {
    const code = card.dataset.code;
    const product = categoryProducts.find(p => p.code === code);
    if (product) {
      card.addEventListener('click', () => {
        sessionStorage.setItem('fromTab', 'category');
        sessionStorage.setItem('fromCategoryName', categoryName);
        window.location.href = `shopping-details.html?code=${product.code}&from=category`;
      });
    }
  });
}



  function renderProductsToGrid(products, gridEl, context = '', categoryName = '') {
  if (!gridEl) return;
  gridEl.innerHTML = '';

  products.forEach((p, idx) => {
    // --- Create product card container
    const card = document.createElement('div');
    card.className = 'product-card';
    card.dataset.code = p.code || '';

    // --- Create image wrapper
    const imgWrapper = document.createElement('div');
    imgWrapper.className = 'product-image';

    // --- Create and load product image
    const img = document.createElement('img');
    img.loading = 'lazy';
    const driveFileId = p.image1;
    img.src = driveFileId
      ? `https://drive.google.com/uc?export=view&id=${driveFileId}`
      : `images/products/${p.code}/1.jpg`;
    img.alt = p.name || 'Product';

    // --- Create cart icon button (bottom-right of image)
    const cartBtn = document.createElement('button');
    cartBtn.className = 'cart-btn';
    cartBtn.innerHTML = '<i class="fa-solid fa-cart-plus"></i>';
    cartBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent opening product details
      openSizePopup(p); // Custom function for popup
    });

    // Append image and cart button inside wrapper
    imgWrapper.appendChild(img);
    imgWrapper.appendChild(cartBtn);

    // --- Product Name
    const name = document.createElement('div');
    name.className = 'product-name';
    name.textContent = p.name || '';

    // --- Product Price
    const price = document.createElement('div');
    price.className = 'product-price';
    price.textContent = p.sellingPrice ? `‚Çπ${p.sellingPrice}` : '';

    // --- Add elements to card
    card.appendChild(imgWrapper);
    card.appendChild(name);
    card.appendChild(price);

    // --- Handle redirection logic
    const codeLower = (p.code || '').toLowerCase();
    const fromParam = context === 'category' ? '&from=category' : '';

    const handleClick = (detailPage) => {
      sessionStorage.setItem('fromTab', context || 'shopping');
      if (context === 'category' && categoryName)
        sessionStorage.setItem('fromCategoryName', categoryName);

      window.location.href = `${detailPage}?code=${encodeURIComponent(p.code)}${fromParam}`;
    };

    if (codeLower.includes('pf')) {
      card.addEventListener('click', () => handleClick('fragrance-details.html'));
    } else {
      card.addEventListener('click', () => handleClick('shopping-details.html'));
    }

    // --- Optional: animation index variable
    card.style.setProperty('--i', idx);

    // --- Finally, append card to grid container
    gridEl.appendChild(card);
  });
}


function initCartButtons() {
  const cart = getCart() || [];
  cart.forEach(item => {
    // Find the product card button for this code
    const cardBtn = document.querySelector(`.product-card[data-code="${item.code}"] .cart-btn`);
    if (cardBtn) cardBtn.disabled = true;
  });
}


let selectedProduct = null;
let selectedSizeCode = null;

async function openSizePopup(product) {
  const popup = document.getElementById('sizePopup');
  const sizeOptions = document.getElementById('sizeOptions');
  const closeBtn = document.getElementById('closePopup');
  const confirmBtn = document.getElementById('confirmSizeBtn');

  // Reset selection
  selectedProduct = null;
  selectedSizeCode = null;
  confirmBtn.disabled = true;
  confirmBtn.textContent = 'Select Size';
  sizeOptions.innerHTML = 'Loading...';
  popup.style.display = 'flex';

  // Get all sizes for this base product
  const baseCode = getBaseCode(product.code);
  const all = allProductsCache.filter(p => p.code.startsWith(baseCode));

  // Fetch inventory
  const inventory = await fetchInventoryFromFirestore();
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  const available = all.filter(p => invMap[p.code] > 0);

  const sizeMap = {
    "XXXS":"XXXS","0XXS":"XXS","00XS":"XS","000S":"S","000M":"M",
    "000L":"L","00XL":"XL","0XXL":"XXL","XXXL":"XXXL",
    "0000":"UnStitched","0100":"100 ml","0050":"50 ml"
  };

  sizeOptions.innerHTML = '';

  if (available.length === 0) {
    sizeOptions.innerHTML = '<p style="color:#731a2f;">No sizes available</p>';
  } else {
    available.forEach(p => {
      const btn = document.createElement('button');
      const sizeSuffix = p.code.slice(-4);
      btn.textContent = sizeMap[sizeSuffix] || sizeSuffix;

      btn.addEventListener('click', () => {
        // Highlight selected size
        document.querySelectorAll('#sizeOptions button').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');

        selectedProduct = p;
        selectedSizeCode = p.code;

        // Enable confirm button
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Add to Cart';
      });

      sizeOptions.appendChild(btn);
    });
  }

  // Close popup
  closeBtn.onclick = () => popup.style.display = 'none';

  // Confirm selection
  confirmBtn.onclick = () => {
    if (!selectedProduct) return;

    // Add product to cart
    toggleCartFromGrid(selectedProduct);

    const imgSrc = selectedProduct.image1
    ? `https://drive.google.com/uc?export=view&id=${selectedProduct.image1}`
    : `images/products/${selectedProduct.code}/1.jpg`;
  animateToCart(imgSrc);

    // Disable add-to-cart button on the product card
    const cardBtn = document.querySelector(`.product-card[data-code="${selectedProduct.code}"] .cart-btn`);
    if (cardBtn) cardBtn.disabled = true;

    popup.style.display = 'none';
  };
}





  // Close popup
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('closePopup').addEventListener('click', closePopup);
    document.getElementById('confirmSizeBtn').addEventListener('click', closePopup);
  });

  function closePopup() {
    document.getElementById('sizePopup').style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  // Optional: close on click outside popup
  document.getElementById('sizePopup').addEventListener('click', (e) => {
    if (e.target.id === 'sizePopup') closePopup();
  });

function toggleCartFromGrid(prod) {
  let cart = getCart() || [];
  const idx = cart.findIndex(item => item.code === prod.code);

  if (idx >= 0) {
    // Remove from cart
    cart.splice(idx, 1);
  } else if (cart.length < 3) {
    // Add to cart
    cart.push({
      code: prod.code,
      name: prod.name,
      price: prod.sellingPrice,
      img: prod.image1 ? `https://drive.google.com/uc?export=view&id=${prod.image1}` : '',
      size: prod.size || '-',
      color: prod.color || '-',
      quantity: 1
    });
  }

  // Save cart
  localStorage.setItem('cart', JSON.stringify(cart));

  // Update cart tab count
  updateCartTabCount(cart);

  // Update all product buttons instantly
  updateAllCartButtons();
}


function animateToCart(productImageSrc) {
  const cartTab = document.querySelector('#tab-cart, #cartTab');
  if (!cartTab) return;

  // Create image element
  const img = document.createElement('img');
  img.src = productImageSrc;
  img.className = 'fly-image';
  document.body.appendChild(img);

  // Get cart position
  const cartRect = cartTab.getBoundingClientRect();
  const startX = window.innerWidth / 2;
  const startY = window.innerHeight / 2;
  const endX = cartRect.left + cartRect.width / 2;
  const endY = cartRect.top + cartRect.height / 2;

  // Play woosh sound
  const audio = new Audio('sounds/woosh.mp3');
  audio.volume = 0.3; // gentle volume
  audio.play().catch(() => {}); // ignore autoplay restriction

  // Animate flight
  img.animate(
    [
      { transform: `translate(-50%, -50%) scale(1)`, opacity: 1 },
      {
        transform: `translate(${endX - startX}px, ${endY - startY}px) scale(0.15)`,
        opacity: 0.1
      }
    ],
    {
      duration: 4000, // slower, smoother
      easing: 'cubic-bezier(0.22, 1, 0.36, 1)', // easeOutBack-like curve
      fill: 'forwards'
    }
  ).onfinish = () => img.remove();

  // Optional: make the cart pulse when image reaches
  setTimeout(() => {
    cartTab.classList.add('cart-pulse');
    setTimeout(() => cartTab.classList.remove('cart-pulse'), 500);
  }, 1900);
}



function updateAllCartButtons() {
  const cart = getCart() || [];
  const cartBaseCodes = cart.map(item => getBaseCode(item.code)); // base codes in cart
  const cartLength = cart.length;

  const buttons = document.querySelectorAll('.product-card .cart-btn');

  buttons.forEach(btn => {
    const productCode = btn.closest('.product-card').dataset.code;
    const baseCode = getBaseCode(productCode);

    const inCart = cartBaseCodes.includes(baseCode);

    if (inCart) {
      // Any size of this base product is in cart ‚Üí disable button
      btn.disabled = true;
    } else if (cartLength >= 3) {
      // Cart full ‚Üí disable others
      btn.disabled = true;
    } else {
      btn.disabled = false;
    }
  });
}


function getBaseCode(code) {
  // Remove last 4 characters (size suffix)
  return code.slice(0, -4);
}



function getCart() {
  try {
    return JSON.parse(localStorage.getItem('cart') || "[]");
  } catch {
    return [];
  }
}


function updateCartTabCount(cart) {
  const total = cart.reduce((sum, i) => sum + (i.quantity || 1), 0);
  const cartTab = document.getElementById('cartTab');
  if (cartTab) {
    cartTab.textContent = total > 0 ? `Cart (${total})` : "Cart";
  }
}




  function setupCategoryFiltersAndSearch(allProducts, categoryName, initialVisible) {
  const grid = document.getElementById('categoryProductsGrid');
  const searchInput = document.getElementById('searchCategory');
  const sizeSelect = document.getElementById('filterCategorySize');
  const colorSelect = document.getElementById('filterCategoryColor'); // Added
  const minInput = document.getElementById('categoryPriceMin');
  const maxInput = document.getElementById('categoryPriceMax');
  const clearBtn = document.getElementById('clearCategoryFilters');
  const noEl = document.getElementById('categoryProductsNo');

  if (!grid || !searchInput || !sizeSelect || !colorSelect || !minInput || !maxInput || !clearBtn) return;

  // --- category key for localStorage
  const catKey = (categoryName || 'default').toLowerCase().replace(/\s+/g, '_');

  // --- Populate size and color dynamically based on available products
  function populateFilters() {
    const sizes = Array.from(new Set(allProducts.map(p => p.size).filter(Boolean))).sort();
    sizeSelect.innerHTML = '<option value="">All Sizes</option>';
    sizes.forEach(s => sizeSelect.appendChild(new Option(s, s)));

    const colors = Array.from(new Set(allProducts.map(p => p.color).filter(Boolean))).sort();
    colorSelect.innerHTML = '<option value="">All Colors</option>';
    colors.forEach(c => colorSelect.appendChild(new Option(c, c)));
  }
  populateFilters();

  // --- save filters
  function storeCategoryFilters() {
    localStorage.setItem(`${catKey}_search`, searchInput.value || "");
    localStorage.setItem(`${catKey}_size`, sizeSelect.value || "");
    localStorage.setItem(`${catKey}_color`, colorSelect.value || "");
    localStorage.setItem(`${catKey}_minPrice`, minInput.value || "");
    localStorage.setItem(`${catKey}_maxPrice`, maxInput.value || "");
  }

  // --- restore filters
  function restoreCategoryFilters() {
    searchInput.value = localStorage.getItem(`${catKey}_search`) || "";
    sizeSelect.value = localStorage.getItem(`${catKey}_size`) || "";
    colorSelect.value = localStorage.getItem(`${catKey}_color`) || "";
    minInput.value = localStorage.getItem(`${catKey}_minPrice`) || "";
    maxInput.value = localStorage.getItem(`${catKey}_maxPrice`) || "";
  }

  // --- filtering logic
  function applyFilters() {
    const searchText = (searchInput.value || '').toLowerCase().trim();
    const selectedSize = (sizeSelect.value || '').toLowerCase().trim();
    const selectedColor = (colorSelect.value || '').toLowerCase().trim();
    const min = parseFloat(minInput.value) || 0;
    const max = parseFloat(maxInput.value) || Infinity;

    const filteredAll = allProducts.filter(p => {
      const nameMatch = ((p.name || '') + ' ' + (p.code || '')).toLowerCase().includes(searchText);
      const sizeMatch = !selectedSize || (p.size || '').toLowerCase() === selectedSize;
      const colorMatch = !selectedColor || (p.color || '').toLowerCase() === selectedColor;
      const price = parseFloat(p.sellingPrice) || 0;
      const priceMatch = price >= min && price <= max;
      return nameMatch && sizeMatch && colorMatch && priceMatch;
    });

    let finalList;
    if (!selectedSize) {
      const seen = new Set();
      finalList = filteredAll.filter(p => {
        const base = getBaseCode(p.code);
        if (seen.has(base)) return false;
        seen.add(base);
        return true;
      });
    } else {
      finalList = filteredAll;
    }

    renderProductsToGrid(finalList, grid, 'category', categoryName);
    initCartButtons();
    updateAllCartButtons();
    noEl.style.display = (!finalList || finalList.length === 0) ? 'block' : 'none';
  }

  // --- attach events
  [searchInput, sizeSelect, colorSelect, minInput, maxInput].forEach(el => {
    if (!el) return;
    el.removeEventListener('input', applyFilters);
    el.addEventListener('input', () => {
      applyFilters();
      storeCategoryFilters();
    });
  });

  clearBtn.removeEventListener('click', applyFilters);
  clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    sizeSelect.value = '';
    colorSelect.value = '';
    minInput.value = '';
    maxInput.value = '';
    applyFilters();
    storeCategoryFilters();
  });

  restoreCategoryFilters();
  applyFilters();
}





    // MENU toggle
    function toggleMenu(){
      const menu = document.getElementById('menu'); const icon = document.getElementById('menuIcon');
      if (!menu) return;
      menu.classList.toggle('show'); icon.classList.toggle('open');
      if (menu.classList.contains('show')) { menu.querySelectorAll('a').forEach((a,i)=>a.style.setProperty('--i', i)); menu.setAttribute('aria-hidden','false'); }
      else menu.setAttribute('aria-hidden','true');
    }

    function openCategoryView(){
      const menu = document.getElementById('menu'); const icon = document.getElementById('menuIcon');
      if (menu && menu.classList.contains('show')){ menu.classList.remove('show'); if (icon) icon.classList.remove('open'); menu.setAttribute('aria-hidden','true'); }
      document.querySelectorAll('.tabcontent').forEach(t=>{ t.classList.remove('active'); t.style.display='none'; });
      document.getElementById('categoryProductsView').style.display = 'none';
      showCategoryCards();
      Array.from(document.getElementsByClassName('tablink')).forEach(b=>b.classList.remove('active'));
      const btn = document.getElementById('tab-category-nav'); if (btn) btn.classList.add('active');
    }

    // SETUP Shopping/Fragrance filter & search - same logic with restored visuals
    function setupShoppingFiltersAndSearch(){
      const searchInput = document.getElementById("searchShopping");
      const clearBtn = document.getElementById("clearShopping");
      const sizeFilter = document.getElementById("filterSize");
      const colorFilter = document.getElementById("filterColor");
      const minPrice = document.getElementById("priceMin");
      const maxPrice = document.getElementById("priceMax");

      function applyFiltersAndSearch(){
        const size = sizeFilter ? sizeFilter.value.toLowerCase() : "";
        const color = colorFilter ? colorFilter.value.toLowerCase() : "";
        const min = parseFloat(minPrice.value) || 0;
        const max = parseFloat(maxPrice.value) || Infinity;
        const searchText = (searchInput.value||'').toLowerCase();

        localStorage.setItem("shoppingSearch", searchInput.value);
        localStorage.setItem("shoppingSize", sizeFilter ? sizeFilter.value : "");
        localStorage.setItem("shoppingColor", colorFilter ? colorFilter.value : "");
        localStorage.setItem("shoppingMinPrice", minPrice.value);
        localStorage.setItem("shoppingMaxPrice", maxPrice.value);

        const filtered = shoppingProducts.filter(p=>{
          const cardSize = (p.size||"").toLowerCase();
          const cardColor = (p.color||"").toLowerCase();
          const price = parseFloat(p.sellingPrice) || 0;
          const sizeMatch = !size || cardSize === size;
          const colorMatch = !color || cardColor === color;
          const priceMatch = price >= min && price <= max;
          const searchMatch = (p.name||"").toLowerCase().includes(searchText) || (p.code||"").toLowerCase().includes(searchText) || (p.sellingPrice||"").toString().includes(searchText);
          return sizeMatch && colorMatch && priceMatch && searchMatch;
        });

        let deduped=[]; let seenBase=new Set();
        if (!size) { filtered.forEach(p=>{ const base=getBaseCode(p.code); if(!seenBase.has(base)){ seenBase.add(base); deduped.push(p); }}); }
        else deduped = filtered;

        const grid = document.getElementById('shoppingGrid'), no=document.getElementById('shoppingNoProducts');
        if (deduped.length===0){ grid.style.display='none'; no.style.display='block'; }
        else { grid.style.display='grid'; no.style.display='none'; renderShoppingGrid(deduped); }
      }

      [searchInput, sizeFilter, colorFilter, minPrice, maxPrice].forEach(el=>{ if (el) el.addEventListener('input', applyFiltersAndSearch); });
      clearBtn.addEventListener('click', ()=>{ searchInput.value=''; if (sizeFilter) sizeFilter.value=''; if (colorFilter) colorFilter.value=''; minPrice.value=''; maxPrice.value=''; localStorage.removeItem("shoppingSearch"); localStorage.removeItem("shoppingSize"); localStorage.removeItem("shoppingColor"); localStorage.removeItem("shoppingMinPrice"); localStorage.removeItem("shoppingMaxPrice"); applyFiltersAndSearch(); });
      return applyFiltersAndSearch;
    }

    function setupFragranceFiltersAndSearch(){
      const searchInput = document.getElementById("searchFragrance");
      const clearBtn = document.getElementById("clearFragrance");
      const sizeFilter = document.getElementById("filterFragranceSize");
      const minPrice = document.getElementById("fragranceMinPrice");
      const maxPrice = document.getElementById("fragranceMaxPrice");

      function applyFiltersAndSearch(){
        const size = (sizeFilter.value||'').toLowerCase();
        const min = parseFloat(minPrice.value) || 0;
        const max = parseFloat(maxPrice.value) || Infinity;
        const searchText = (searchInput.value||'').toLowerCase();

        localStorage.setItem("searchFragrance", searchInput.value);
        localStorage.setItem("filterFragranceSize", sizeFilter.value);
        localStorage.setItem("fragranceMinPrice", minPrice.value);
        localStorage.setItem("fragranceMaxPrice", maxPrice.value);

        const filtered = fragranceProducts.filter(p=>{
          const cardSize = (p.size||'').toLowerCase();
          const price = parseFloat(p.sellingPrice) || 0;
          const sizeMatch = !size || cardSize === size;
          const priceMatch = price >= min && price <= max;
          const searchMatch = (p.name||'').toLowerCase().includes(searchText) || (p.code||'').toLowerCase().includes(searchText) || (p.sellingPrice||'').toString().includes(searchText);
          return sizeMatch && priceMatch && searchMatch;
        });

        const grid=document.getElementById('fragranceGrid'), no=document.getElementById('fragranceNoProducts');
        if (filtered.length===0){ grid.style.display='none'; no.style.display='block'; } else { grid.style.display='grid'; no.style.display='none'; renderFragranceGrid(filtered); }
      }

      [searchInput, sizeFilter, minPrice, maxPrice].forEach(el=>el.addEventListener('input', applyFiltersAndSearch));
      clearBtn.addEventListener('click', ()=>{ searchInput.value=''; sizeFilter.value=''; minPrice.value=''; maxPrice.value=''; localStorage.removeItem("searchFragrance"); localStorage.removeItem("filterFragranceSize"); localStorage.removeItem("fragranceMinPrice"); localStorage.removeItem("fragranceMaxPrice"); renderFragranceGrid(fragranceProducts); });
      return applyFiltersAndSearch;
    }

    function restoreFiltersAndApply(applyFilters){
      const searchInput = document.getElementById("searchShopping"), sizeFilter = document.getElementById("filterSize"), colorFilter = document.getElementById("filterColor"), minPrice = document.getElementById("priceMin"), maxPrice = document.getElementById("priceMax");
      if (searchInput) searchInput.value = localStorage.getItem("shoppingSearch") || "";
      if (sizeFilter) sizeFilter.value = localStorage.getItem("shoppingSize") || "";
      if (colorFilter) colorFilter.value = localStorage.getItem("shoppingColor") || "";
      if (minPrice) minPrice.value = localStorage.getItem("shoppingMinPrice") || "";
      if (maxPrice) maxPrice.value = localStorage.getItem("shoppingMaxPrice") || "";
      if (applyFilters) applyFilters();
    }

    function restoreFragranceFiltersAndApply(applyFilters){
      const s=document.getElementById("searchFragrance"), sz=document.getElementById("filterFragranceSize"), min=document.getElementById("fragranceMinPrice"), max=document.getElementById("fragranceMaxPrice");
      if (s) s.value = localStorage.getItem("searchFragrance") || "";
      if (sz) sz.value = localStorage.getItem("filterFragranceSize") || "";
      if (min) min.value = localStorage.getItem("fragranceMinPrice") || "";
      if (max) max.value = localStorage.getItem("fragranceMaxPrice") || "";
      if (applyFilters) applyFilters();
    }

    // Slideshow (5s)
    function initSlideshow(intervalMs = 5000){
      const slides = document.querySelectorAll('.slide');
      const dots = document.querySelectorAll('.dot');
      if (!slides || slides.length === 0) return;
      let currentIndex = 0;
      function showSlide(i){
        slides.forEach((s, idx)=> s.classList.toggle('active', idx === i));
        dots.forEach((d, idx)=> d.classList.toggle('active', idx === i));
        currentIndex = i;
      }
      let auto = setInterval(()=> showSlide((currentIndex+1)%slides.length), intervalMs);
      dots.forEach(dot=> dot.addEventListener('click', ()=>{ clearInterval(auto); showSlide(Number(dot.dataset.index)); auto = setInterval(()=> showSlide((currentIndex+1)%slides.length), intervalMs); }));
    }


    // small helper search for grids
    function setupSearch(inputId, clearBtnId, targetId){
      const searchInput = document.getElementById(inputId); if (!searchInput) return;
      searchInput.addEventListener('input', ()=>{
        const filter = searchInput.value.toLowerCase();
        document.getElementById(targetId).querySelectorAll('.product-card').forEach(card=>{
          const text = card.textContent.toLowerCase();
          card.style.display = text.includes(filter) ? '' : 'none';
        });
      });
      const clearBtn = document.getElementById(clearBtnId);
      if (clearBtn) clearBtn.addEventListener('click', ()=>{ searchInput.value=''; searchInput.dispatchEvent(new Event('input')); });
    }

    function goToCart(){ window.location.href = 'cart.html'; }

     const SESSION_KEY = "visitorSession";
const LOCATION_KEY = "visitorLatLon";
let heartbeatTimer = null;
let lastActivityTime = Date.now();
let isTabActive = true;
const HEARTBEAT_INTERVAL = 15 * 1000; // 15 seconds
const INACTIVITY_LIMIT = 60 * 1000;   // 1 minute of inactivity

// --- Get or create session ID ---
function getSessionId() {
    const now = Date.now();
    let sessionData = null;
    try { sessionData = JSON.parse(localStorage.getItem(SESSION_KEY)); } catch {}
    if (sessionData && (now - sessionData.lastActive < 2 * 60 * 60 * 1000)) {
        sessionData.lastActive = now;
    } else {
        sessionData = { id: Math.random().toString(36).substring(2, 10), lastActive: now };
    }
    localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
    return sessionData.id;
}

// --- Get GPS location (cached per session) ---
async function getGeoLocation() {
    const cached = localStorage.getItem(LOCATION_KEY);
    if (cached) return JSON.parse(cached);
    if (!navigator.geolocation) return { lat: "unknown", lon: "unknown" };
    try {
        const pos = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 10000 });
        });
        const coords = { lat: pos.coords.latitude, lon: pos.coords.longitude };
        localStorage.setItem(LOCATION_KEY, JSON.stringify(coords));
        return coords;
    } catch {
        return { lat: "unknown", lon: "unknown" };
    }
}

// --- Get public IP ---
async function getPublicIP() {
    try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip || "unknown";
    } catch {
        return "unknown";
    }
}

// --- Core function: Send visit or heartbeat ---
async function trackVisitor(type = "pageview") {
    const sessionId = getSessionId();
    const { lat, lon } = await getGeoLocation();
    const ip = await getPublicIP();
    const page = window.location.href;
    const browser = navigator.userAgent;

    const callbackName = "visitorCallback_" + Math.random().toString(36).substring(2, 10);
    const url = new URL("https://script.google.com/macros/s/AKfycbw5tep2lIfqr0ITB_M2TQWSZ9aPXkXcK_0pX2eCL47AnEwuuQ-CIMzmTgkqsRSM6U29tw/exec");

    url.searchParams.set("callback", callbackName);
    url.searchParams.set("sessionId", sessionId);
    url.searchParams.set("ip", ip);
    url.searchParams.set("page", page);
    url.searchParams.set("browser", browser);
    url.searchParams.set("lat", lat);
    url.searchParams.set("lon", lon);
    url.searchParams.set("type", type);

    window[callbackName] = function (data) {
        console.log(`Visitor ${type}:`, data);
        delete window[callbackName];
        document.body.removeChild(script);
    };

    const script = document.createElement("script");
    script.src = url.toString();
    document.body.appendChild(script);

    // reset heartbeat timing reference
    lastActivityTime = Date.now();
    resetHeartbeat(); 
}

// --- Heartbeat Control ---
function startHeartbeat() {
    if (heartbeatTimer) return;
    heartbeatTimer = setInterval(() => {
        const now = Date.now();
        const inactive = now - lastActivityTime > INACTIVITY_LIMIT;
        if (!isTabActive || inactive) {
            console.log("Heartbeat paused (inactive/tab hidden)");
            stopHeartbeat();
            return;
        }
        trackVisitor("heartbeat");
    }, HEARTBEAT_INTERVAL);
}

function stopHeartbeat() {
    if (heartbeatTimer) {
        clearInterval(heartbeatTimer);
        heartbeatTimer = null;
    }
}

function resetHeartbeat() {
    stopHeartbeat();
    startHeartbeat();
}

// --- Activity tracking ---
function markActive() {
    lastActivityTime = Date.now();
    if (isTabActive && !heartbeatTimer) {
        console.log("User active ‚Äî restarting heartbeat");
        startHeartbeat();
    }
}

// --- Tab visibility ---
document.addEventListener("visibilitychange", () => {
    isTabActive = !document.hidden;
    if (isTabActive) {
        console.log("Tab active again ‚Äî resuming heartbeat");
        markActive();
    } else {
        console.log("Tab hidden ‚Äî stopping heartbeat");
        stopHeartbeat();
    }
});

// --- Detect user activity events ---
["mousemove", "keydown", "scroll", "touchstart"].forEach(evt =>
    window.addEventListener(evt, markActive)
);

// --- When page loads ---
window.addEventListener("DOMContentLoaded", async () => {
    await trackVisitor("pageview"); // Always call on page load
    startHeartbeat();               // Start interval heartbeat
});

// --- Stop heartbeat when leaving page ---
window.addEventListener("beforeunload", () => {
    stopHeartbeat();
});

  window.addEventListener('DOMContentLoaded', () => {
  updateCartTabCount(getCart());
  const fromTab = sessionStorage.getItem('fromTab');
  const fromCategory = sessionStorage.getItem('fromCategoryName');

  // Hide all tab content initially
  document.querySelectorAll('.tabcontent').forEach(t => {
    t.classList.remove('active');
    t.style.display = 'none';
  });

  // ‚úÖ Restore correct tab based on saved state
  if (fromTab === 'fragrance') {
    openTabFromMenu('fragrance');
  } 
  else if (fromTab === 'shopping') {
    openTabFromMenu('shopping'); // ‚úÖ restore fashion tab when coming back
  } 
  else if (fromTab === 'category' && fromCategory) {
    showProductsForCategory(fromCategory);
  } 
  else {
    openTabFromMenu('category'); // ‚úÖ default landing tab is category
  }

  // optional: clear session memory for next visit
  sessionStorage.removeItem('fromTab');
  sessionStorage.removeItem('fromCategoryName');

  // start banner slideshow
  initSlideshow();
});






  </script>
</body>
</html>
