<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ‚úÖ Basic SEO -->
  <title>Foyer Studio‚Ñ¢ ‚Äî Best Online Boutique in Kasaragod, Kerala</title>

 <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Playfair+Display:wght@500&display=swap" rel="stylesheet">
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>



  <meta name="description" content="Foyer Studio‚Ñ¢ is one of the best online boutiques in Kerala, offering elegant clothing in Kasaragod, Manjeshwar, and Kunjathur. Shop timeless fashion that inspires confidence and style. Visit foyerstudio.in or contact fashion@foyerstudio.in.">
  <meta name="keywords" content="best online boutique Kerala, boutique Kasaragod, online fashion store Manjeshwar, Kunjathur boutique, Foyer Studio, Kerala fashion boutique, best online seller near me, best boutique near me">
  <meta name="author" content="Foyer Studio">

  <!-- ‚úÖ Open Graph / Facebook / WhatsApp -->
  <meta property="og:title" content="Foyer Studio‚Ñ¢ - Best Online Boutique in Kerala">
  <meta property="og:description" content="Explore elegant clothing from Foyer Studio‚Ñ¢, a leading online boutique in Kasaragod, Manjeshwar, and Kunjathur, Kerala.">
  <meta property="og:image" content="https://foyerstudio.in/images/logo_red.png">
  <meta property="og:url" content="https://foyerstudio.in">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Foyer Studio">

  <!-- ‚úÖ Twitter (X) Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Foyer Studio‚Ñ¢ - Best Online Boutique in Kerala">
  <meta name="twitter:description" content="Discover timeless clothing from Foyer Studio‚Ñ¢ ‚Äî serving Kasaragod, Manjeshwar, and Kunjathur, Kerala.">
  <meta name="twitter:image" content="https://foyerstudio.in/images/logo_red.png">

  <!-- ‚úÖ Favicons -->
  <link rel="icon" href="/favicon.png" sizes="32x32" type="image/png">
  <link rel="apple-touch-icon" href="/favicon.png">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">

  <!-- ‚úÖ Canonical URL -->
  <link rel="canonical" href="https://foyerstudio.in">

  <!-- ‚úÖ Social Profiles -->
  <link rel="me" href="https://www.instagram.com/foyerstudio" />
  <link rel="me" href="https://wa.me/919037622566" />

  <!-- ‚úÖ Structured Data: Organization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Foyer Studio",
    "url": "https://foyerstudio.in",
    "logo": "https://foyerstudio.in/images/logo_red.png",
    "email": "fashion@foyerstudio.in",
    "sameAs": [
      "https://www.instagram.com/foyerstudio",
      "https://wa.me/919037622566"
    ],
    "description": "Foyer Studio‚Ñ¢ is an online boutique dedicated to timeless fashion, offering elegant clothing designed to inspire confidence and style.",
    "founder": "Foyer Studio Team",
    "contactPoint": {
      "@type": "ContactPoint",
      "email": "fashion@foyerstudio.in",
      "contactType": "customer support",
      "availableLanguage": ["English"]
    }
  }
  </script>

  <!-- ‚úÖ Structured Data: Local Business -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Foyer Studio",
    "image": "https://foyerstudio.in/images/logo_red.png",
    "url": "https://foyerstudio.in",
    "telephone": "+919037622566",
    "email": "fashion@foyerstudio.in",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Kunjathur, Manjeshwar",
      "addressLocality": "Kasaragod",
      "addressRegion": "Kerala",
      "postalCode": "671323",
      "addressCountry": "IN"
    },
    "openingHours": "Mo-Su 09:00-21:00",
    "priceRange": "‚Çπ‚Çπ",
    "sameAs": [
      "https://www.instagram.com/foyerstudio",
      "https://wa.me/919037622566"
    ],
    "description": "Foyer Studio‚Ñ¢ is a local online boutique in Kerala offering elegant clothing. Serving customers in Kasaragod, Manjeshwar, and Kunjathur."
  }
  </script>

  <style>
:root {
  --header-height: 88px;
  --card-anim-delay: 60ms;
}

/* Base reset & global */
html, body {
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
  background: #fefef6;
  color: #731a2f;
  scroll-behavior: smooth;
   max-width: 100%;
  overflow-x: hidden;
}
body {
  padding-top: var(--header-height);
  transition: opacity .25s ease;
  overflow-x: hidden;
}

/* Fixed top banner */
.banner {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: var(--header-height);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  background: #fefef6;
  z-index: 2200;
  border-bottom: 1px solid rgba(0,0,0,0.04);
  padding-top: 6px;
}
.banner-logo {
  height: 46px;
  width: auto;
}
.banner .title {
  font-family: 'Playfair Display', serif;
  font-size: 1.45rem;
  color: #731a2f;
  margin-top: 4px;
  text-align: center;
}


/* Floating Menu Button */
.menu-fab {
  position: fixed;
  top: 10px;
  left: 16px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #fefef6;
  box-shadow: 0 6px 15px rgba(0,0,0,0.12);
  cursor: pointer;
  z-index: 2400;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.25s ease, background 0.25s ease;
}
.menu-fab:hover {
  transform: scale(1.05);
  background: #f9f9f9;
}

/* Bars inside button */
.menu-fab .bar,
.menu-fab .bar::before,
.menu-fab .bar::after {
  content: '';
  display: block;
  width: 24px;
  height: 3px;
  background: #731a2f;
  border-radius: 2px;
  position: relative;
  transition: all 0.4s cubic-bezier(.77,0,.175,1);
}
.menu-fab .bar::before {
  position: absolute;
  top: -8px;
  left: 0;
}
.menu-fab .bar::after {
  position: absolute;
  top: 8px;
  left: 0;
}

/* Morph into X when open */
.menu-fab.open .bar {
  background: transparent;
}
.menu-fab.open .bar::before {
  transform: rotate(45deg);
  top: 0;
}
.menu-fab.open .bar::after {
  transform: rotate(-45deg);
  top: 0;
}

.menu {
  position: fixed;
  top: 0px;
  left: 0;
  width: 280px;
  height: 100vh;
  background: #fefef6;
  box-shadow: 3px 0 10px rgba(0,0,0,0.15);
  padding: 80px 25px 25px; /* top spacing for icon gap */
  transform: translateX(-100%);
  opacity: 0;
  visibility: hidden;
  transition: transform 0.4s ease, opacity 0.4s ease;
  display: flex;
  flex-direction: column;
  gap: 16px;
  z-index: 2300;
}

.menu::before {
  content: "";
  position: absolute;
  top: 70px; /* match top padding exactly */
  left: 0;
  width: 100%;
  height: 1px;
  background: #731a2f;
  opacity: 0.3; /* subtle look */
  pointer-events: none; /* prevent blocking clicks */
}



/* Visible when .show is added */
.menu.show {
  transform: translateX(0);
  opacity: 1;
  visibility: visible;
}

/* Menu links */
.menu a {
  text-decoration: none;
  color: #731a2f;
  font-size: 1.1rem;
  font-weight: 300;
  transition: color 0.2s ease;
}
.menu a:hover {
  color: #b21f32;
}

/* Base link style */
.menu a {
  text-decoration: none;
  color: #731a2f;
  font-size: 1.1rem;
  font-weight: 300;
  opacity: 0;
  transform: translateX(-20px);
  transition: color 0.2s ease;
}

/* Animate links in horizontally (left ‚Üí right) */
.menu.show a {
  animation: fadeSlideInX 0.35s ease forwards;
}

/* Stagger timing for each link */
.menu.show a:nth-child(1) { animation-delay: 0.05s; }
.menu.show a:nth-child(2) { animation-delay: 0.10s; }
.menu.show a:nth-child(3) { animation-delay: 0.15s; }
.menu.show a:nth-child(4) { animation-delay: 0.20s; }
.menu.show a:nth-child(5) { animation-delay: 0.25s; }
.menu.show a:nth-child(6) { animation-delay: 0.30s; }
.menu.show a:nth-child(7) { animation-delay: 0.35s; }
.menu.show a:nth-child(8) { animation-delay: 0.40s; }

/* Keyframes: soft fade + slide horizontally */
@keyframes fadeSlideInX {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* --- Ensure Horizontal Animation on All Devices --- */
@media (max-width: 768px) {
  .menu {
    width: 80%;
    padding: 80px 20px;
  }

  .menu a {
    font-size: 1rem;
    transform: translateX(-20px); /* explicitly set horizontal base */
  }

  .menu.show a {
    animation: fadeSlideInX 0.4s ease forwards;
    transform-origin: left center; /* force horizontal flow */
  }

  /* Proper staggered animation sequence */
  .menu.show a:nth-child(1) { animation-delay: 0.05s; }
  .menu.show a:nth-child(2) { animation-delay: 0.10s; }
  .menu.show a:nth-child(3) { animation-delay: 0.15s; }
  .menu.show a:nth-child(4) { animation-delay: 0.20s; }
  .menu.show a:nth-child(5) { animation-delay: 0.25s; }
  .menu.show a:nth-child(6) { animation-delay: 0.30s; }
  .menu.show a:nth-child(7) { animation-delay: 0.35s; }
  .menu.show a:nth-child(8) { animation-delay: 0.40s; }

  /* Reaffirm keyframes direction */
  @keyframes fadeSlideInX {
    from {
      opacity: 0;
      transform: translateX(-20px); /* always from left */
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
}




/* Nav */
.nav {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  padding: 10px 14px;
  background: #fefef6;
  position: relative;
  z-index: 1200;
}
.nav button {
  background: transparent;
  border: 0;
  color: #731a2f;
  font-size: 16px;
  font-weight: 500;
  padding: 8px 16px;
  border-radius: 30px;
  cursor: pointer;
  transition: all .22s ease;
}
.nav button:hover, .nav button.active {
  background: #731a2f;
  color: #fefef6;
}

/* Hero / offer banner */
.offer-banner {
  width: 100%;
  max-height: 400px;      /* cap height on desktop */
  min-height: 200px;      /* ensures visibility if images fail */
  overflow: hidden;
  position: relative;
  border-radius: 8px;
}

.slides {
  width: 100%;
  height: 100%;
  display: flex;          /* keep images in flex for easier scaling */
  position: relative;
}

.slide {
  flex-shrink: 0;
  width: 100%;
  height: auto;
  object-fit: contain;    /* ensures entire image is visible, no crop */
  display: none;          /* hide initially */
}

.slide.active {
  display: block;         /* only active slide is visible */
}

.dots {
  position: absolute;
  bottom: 10px;
  width: 100%;
  text-align: center;
}

.dot {
  display: inline-block;
  width: 12px;
  height: 12px;
  margin: 0 5px;
  background: rgba(255,255,255,0.5);
  border-radius: 50%;
  cursor: pointer;
}

.dot.active {
  background: rgba(255,255,255,1);
}

@media screen and (max-width: 600px) {
  .offer-banner {
    width: 100%;
    height: auto;          /* match image height */
    max-height: none;      /* remove fixed limit */
    min-height: unset;     /* remove unnecessary min height */
    border-radius: 8px;
    overflow: hidden;
  }

  .slides {
    display: block;        /* stack images properly on mobile */
  }

  .slide {
    width: 100%;
    height: auto;          /* auto height based on image ratio */
    display: none;
  }

  .slide.active {
    display: block;
  }
}


/* Main container */
.main {
  max-width: 1180px;
  margin: 20px auto;
  padding: 0 18px;
}

/* Tab content */
.tabcontent {
  display: none;
  opacity: 0;
  transform: translateY(8px);
  transition: all .36s cubic-bezier(.22,.9,.2,1);
}
.tabcontent.active {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

/* Header wrapper */
.header-wrapper h1 {
  font-family: 'Playfair Display', serif;
  font-size: 1.7rem;
  text-align: center;
  margin: 12px 0 22px;
  color: #731a2f;
}

/* Search box */
.search-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin-bottom: 10px;
}
.search-container input,
.search-container select,
.search-container button {
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  color: #731a2f;
  background: #fefef6;
}
.search-container button {
  background: #731a2f;
  color: #fefef6;
  border: 0;
  cursor: pointer;
}

/* Row grouping (Size+Color, Min+Max) */
.search-row {
  display: flex;
  gap: 10px;
}

/* Inputs inside rows flex equally */
.search-row select,
.search-row input {
  flex: 1;
}



/* Mobile adjustments */
@media (max-width: 480px) {
  .search-container {
    flex-direction: column;
    gap: 10px;     /* vertical spacing */
    margin: 0 5px; /* 5px left & right margin for whole container */
  }

  /* Full-width on small screens */
  .search-container input,
  .search-container select,
  .search-container button {
    width: calc(100% - 10px);
    margin: 0 5px;
  }

  /* Row grouping with margins */
  .search-row {
    margin: 0 5px;
  }
}

/* Remove default number input arrows */
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input[type=number] {
  -moz-appearance: textfield;
  appearance: textfield;
  text-align: center;
  padding-right: 25px;
  position: relative;
}

/* Responsive layout */
@media (max-width: 600px) {
  .search-container {
    flex-direction: column;
    align-items: stretch;
  }

  .search-container input,
  .search-container select {
    width: 100%;
    margin-left: 0;
  }

  .search-container button {
    width: auto;
    padding: 4px 8px;
    font-size: 12px;
    align-self: flex-start; /* Prevent full-width button */
    margin-left: 0;
    margin-bottom: 6px;
  }
}

/* Add spacing below last button */
.search-container .search-row.full:last-child {
  margin-bottom: 5px; /* space after clear button row */
}




/* Product grid */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 22px;
}
.product-card {
  background: #fefef6;
  border-radius: 10px;
  overflow: hidden;
  text-align: center;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  transition: transform .22s ease, box-shadow .22s ease;
  padding-bottom: 12px;
  opacity: 0;
  transform: translateY(10px);
  animation: cardFade .36s ease forwards;
  animation-delay: calc(var(--i) * var(--card-anim-delay));
}
.product-card:hover {
  transform: translateY(-10px) scale(1.03);
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}
@keyframes cardFade { to { opacity: 1; transform: translateY(0); } }

.product-card img {
  width: 100%;
  height: auto;
  object-fit: cover;
}
.product-name {
  font-weight: 500;
  margin-top: 10px;
  color: #731a2f;
  font-size: 15px;
  padding: 0 8px;
}
.product-price {
  color: #731a2f;
  font-size: 14px;
  margin-top: 6px;
  margin-bottom: 8px;
}

@media screen and (max-width: 600px) {
  .grid {
    grid-template-columns: repeat(2, 1fr); /* Two per row */
    gap: 10px; /* Slightly tighter grid for small screens */
  }

  .product-card {
    border-radius: 10px;
    overflow: hidden;
    padding-bottom: 8px;
  }

  .product-card img {
    width: 100%;
    height: auto;           /* uniform height for all images */
    object-fit: cover;       /* fills the area, minor crop */
    border-radius: 10px;     /* rounded corners */
    display: block;
  }

  .product-name,
  .product-price {
    font-size: 13px;
  }
}



.loader {
  width: 100%;
  height: 3px;
  display: none;
  background: transparent;
  position: relative;
}
.loader .bar {
  height: 100%;
  width: 0;
  background: #731a2f;
  animation: loadingAnim 5s linear infinite;
}
@keyframes loadingAnim {
  0% { width: 0; margin-left: 0 }
  50% { width: 60%; margin-left: 20% }
  100% { width: 0; margin-left: 100% }
}

.no-products { text-align: center; color: #999; margin: 18px 0; }
.back-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  border-radius: 30px;
  border: 1.6px solid #731a2f;
  background: #fefef6;
  color: #731a2f;
  font-weight: 500;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}

/* Add a left arrow before text */
.back-btn::before {
  content: "‚Üê";
  font-size: 1rem;
  transition: transform 0.25s ease;
}

/* Hover: reverse colors + slight arrow movement */
.back-btn:hover {
  background: #731a2f;
  color: #fefef6;
  border-color: #731a2f;
  transform: translateX(-2px);
}
.back-btn:hover::before {
  transform: translateX(-3px);
}


.footer-credit a, .footer-credit p {
  font-size: 14px;
  text-decoration: none;
  color: #731a2f;
  transition: color 0.2s;
}

/* Animation for page enter */
.view-enter { animation: viewEnter .36s ease forwards; }
@keyframes viewEnter {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: none; }
}

/* ‚úÖ FULL MOBILE RESPONSIVENESS */
@media (max-width: 1024px) {
  .banner .title { font-size: 1.25rem; }
  .nav { flex-wrap: wrap; }
}

@media (max-width: 768px) {
  :root { --header-height: 72px; }
  .banner-logo { height: 38px; }
  .menu { width: 200px; }
  .banner .title { font-size: 1.1rem; }
  .nav button { font-size: 14px; padding: 6px 12px; }
  .header-wrapper h1 { font-size: 1.4rem; }
}

@media (max-width: 480px) {
  .banner { height: var(--header-height); padding-top: 4px; }
  .banner-logo { height: 32px; }
  .banner .title { font-size: 1rem; }
  .nav { gap: 6px; padding: 8px; }
  .nav button { font-size: 13px; padding: 6px 10px; }
}

/* Product Card Container */


/* Image Container */
.product-image {
  position: relative;
  width: 100%;
  overflow: hidden;
}

.product-image img {
  width: 100%;
  height: auto;
  display: block;
  border-bottom: 1px solid #eee;
}

/* Cart Button Positioned Over Image */
.cart-btn {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background: #ccc;
  color: #000;
  border: none;
  border-radius: 50%;
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  transform: scale(0.9);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

/* Show on hover for desktop */
.product-image:hover .cart-btn {
  opacity: 1;
  transform: scale(1);
}

/* Always show cart button on small screens (mobile) */
@media (max-width: 768px) {
  .cart-btn {
    opacity: 1;
    transform: scale(1);
  }
}


.cart-btn i {
  font-size: 16px;
}

/* Product Info */
.product-name {
  font-size: 14px;
  font-weight: 500;
  color: #333;
  margin: 10px 0 5px;
  text-align: center;
}

.product-price {
  font-size: 14px;
  font-weight: 600;
  color: #000;
  margin-bottom: 10px;
}

 /* === Category Products View === */
  

  .header-wrapper h1 {
    font-size: 20px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 20px;
  }

  .search-container {
    background: #fafafa;
  }

  .search-row.full {
    flex-direction: column;
  }

  #clearCategoryFilters {
    background: #731a2f;
    color: #fefef6;
    font-weight: 500;
    cursor: pointer;
  }


  .no-products {
    text-align: center;
    font-size: 14px;
    color: #777;
    margin-top: 20px;
  }

  /* === Popup Overlay === */
  .popup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(3px);
  }

  .popup {
    background: #fff;
    width: 90%;
    max-width: 380px;
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    padding: 24px 20px 30px;
    position: relative;
    text-align: center;
    animation: popupIn 0.3s ease-out;
  }

  @keyframes popupIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .close-btn {
    position: absolute;
    top: 12px;
    right: 14px;
    background: transparent;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #333;
    transition: transform 0.2s ease;
  }

  .close-btn:hover {
    transform: rotate(90deg);
  }

  .popup h3 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #111;
  }

  .size-options {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 24px;
  }

  .size-options button {
    min-width: 60px;
    padding: 10px 0;
    border: 1.5px solid #ccc;
    background: #fff;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .size-options button:hover {
    border-color: #000;
  }

  .size-options button.selected {
    background: #000;
    color: #fff;
    border-color: #000;
  }

  .confirm-btn {
    background: #000;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 12px 0;
    width: 100%;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: 0.3px;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .confirm-btn:hover {
    background: #222;
  }

  @media (max-width: 480px) {
    .popup {
      width: 80%;
      padding: 20px 16px 24px;
    }
    .size-options button {
      min-width: 50px;
      font-size: 13px;
    }
  }

  .cart-btn:disabled {
  background: #999 !important;
  cursor: not-allowed;
  opacity: 0.6;
}

.size-options button {
  -webkit-tap-highlight-color: transparent; /* remove blue flash */
  outline: none; /* remove focus ring */
}

.size-options button:focus,
.size-options button:active {
  background: #000;
  color: #fff;
  border-color: #000;
  outline: none;
  box-shadow: none;
}

.fly-image {
  position: fixed;
  left: 50%;
  top: 50%;
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 12px;
  z-index: 9999;
  pointer-events: none;
  box-shadow: 0 8px 18px rgba(0,0,0,0.3);
  transform: translate(-50%, -50%);
}

.cart-pulse {
  animation: cartPulse 5s ease;
}

@keyframes cartPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.original-price {
  text-decoration: line-through;
  color: #888;
  margin-right: 5px;
}



</style>

<!-- Meta Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '905330835482362');
  fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=905330835482362&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->

</head>
<body>

 <!-- Menu Icon -->
<div class="menu-fab" id="menuIcon" onclick="toggleMenu()" role="button" aria-label="Toggle menu">
  <div class="bar"></div>
</div>

<!-- Left Sliding Menu -->
<nav id="menu" class="menu" aria-hidden="true">
  <a href="#" onclick="openCategoryView(); return false;" style="--i:2">Women</a>
  <a href="#" onclick="openMenCategoryView(); return false;" style="--i:2">Men</a>
  <a href="#" onclick="openTabFromMenu('fragrance'); return false;" style="--i:1">Fragrance</a>
  <a href="TC.html" style="--i:3">Terms & Conditions</a>
  <a href="privacy-policy.html" style="--i:4">Privacy Policy</a>
  <a href="shipping-policy.html" style="--i:3">Shipping Policy</a>
  <a href="return-policy.html" style="--i:5">Return Policy</a>
  <a href="https://foyerstudio.track123.com/?nums=" style="--i:6">Track Your Order</a>
</nav>



  <!-- Fixed top banner (logo+title) -->
  <header class="banner" role="banner">
    <img src="images/logo_red.png" alt="Foyer Studio Logo" class="banner-logo" />
    <div class="title">Foyer Studio</div>
  </header>

  <!-- navigation (scrolls under banner) -->
<div class="nav" id="topNav">
  <button id="tab-category-nav" class="tablink active" onclick="openTab(event, 'categoryView')">Women</button>
  <button id="tab-Mencategory-nav" class="tablink" onclick="openTab(event, 'MencategoryView')">Men</button>
  <button id="tab-fragrance" class="tablink" onclick="openTab(event, 'fragrance')">Fragrance</button>
  <button id="cartTab" class="tablink" onclick="goToCart()">Cart</button>
</div>


 <div class="offer-banner">
  <div class="slides">
    <img src="images/pakistani.jpg" class="slide active" alt="pakisthani">
    <img src="images/Men.jpg" class="slide" alt="foyermen">
    <img src="images/fragrance.jpg" class="slide" alt="fragrance">
    <img src="images/combo.jpg" class="slide" alt="combo">
  </div>
  <div class="dots">
    <span class="dot active" data-index="0"></span>
    <span class="dot" data-index="1"></span>
    <span class="dot" data-index="2"></span>
    <span class="dot" data-index="3"></span>
  </div>
</div>

  <div id="loader" class="loader"><div class="bar"></div></div>

  <main class="main" role="main">
    <!-- Category view (cards) -->
    <section id="categoryView" style="display:none;">
      <div class="header-wrapper"><h1>Categories</h1></div>
      <div id="categoryGrid" class="grid"></div>
      <div id="categoryNoProducts" class="no-products" style="display:none;">No categories available.</div>
    </section>

    <!-- Category products view (shows after clicking a category) -->
    <section id="categoryProductsView" style="display:none;">
  <div class="header-wrapper"><h1 id="categoryProductsTitle">Category</h1></div>
  <div class="search-container" id="categoryFilters">
  <div class="search-row full">
    <input type="text" id="searchCategory" placeholder="Search product name..." />
  </div>

  <div class="search-row">
    <select id="filterCategorySize"><option value="">All Sizes</option></select>
    <select id="filterCategoryColor"><option value="">All Colors</option></select>
  </div>

  <div class="search-row">
    <input type="number" id="categoryPriceMin" placeholder="Min Price" min="0" />
    <input type="number" id="categoryPriceMax" placeholder="Max Price" min="0" />
  </div>

  <div class="search-row">
    <button onclick="showCategoryCards()">Back</button>
    <button id="clearCategoryFilters">Clear</button>
  </div>
</div>

  <div id="categoryProductsGrid" class="grid"></div>
  <div id="categoryProductsNo" class="no-products" style="display:none;">No products in this category.</div>
</section>

<div id="sizePopup" class="popup-overlay" style="display:none;">
  <div class="popup">
    <button id="closePopup" class="close-btn"><i class="fas fa-times"></i></button>
    <h3>Size Options Available</h3>
    <div id="sizeOptions" class="size-options"></div>
    <button id="confirmSizeBtn" class="confirm-btn">Add to Cart</button>
  </div>
</div>



 <!-- Category view (cards) -->
    <section id="MencategoryView" style="display:none;">
      <div class="header-wrapper"><h1>Categories</h1></div>
      <div id="MencategoryGrid" class="grid"></div>
      <div id="MencategoryNoProducts" class="no-products" style="display:none;">No categories available.</div>
    </section>

    <!-- Category products view (shows after clicking a category) -->
    <section id="MencategoryProductsView" style="display:none;">
  <div class="header-wrapper"><h1 id="MencategoryProductsTitle">Category</h1></div>
  <div class="search-container" id="MencategoryFilters">
  <div class="search-row full">
    <input type="text" id="MensearchCategory" placeholder="Search product name..." />
  </div>

  <div class="search-row">
    <select id="MenfilterCategorySize"><option value="">All Sizes</option></select>
    <select id="MenfilterCategoryColor"><option value="">All Colors</option></select>
  </div>

  <div class="search-row">
    <input type="number" id="MencategoryPriceMin" placeholder="Min Price" min="0" />
    <input type="number" id="MencategoryPriceMax" placeholder="Max Price" min="0" />
  </div>

  <div class="search-row">
    <button onclick="showMenCategoryCards()">Back</button>
    <button id="clearMenCategoryFilters">Clear</button>
  </div>
</div>

  <div id="MencategoryProductsGrid" class="grid"></div>
  <div id="MencategoryProductsNo" class="no-products" style="display:none;">No products in this category.</div>
</section>

<div id="MensizePopup" class="popup-overlay" style="display:none;">
  <div class="popup">
    <button id="MenclosePopup" class="close-btn"><i class="fas fa-times"></i></button>
    <h3>Size Options Available</h3>
    <div id="MensizeOptions" class="size-options"></div>
    <button id="MenconfirmSizeBtn" class="confirm-btn">Add to Cart</button>
  </div>
</div>




<section id="FragranceView" style="display:none;">
  <div class="header-wrapper">
    <h1>Categories</h1>
  </div>

  <div id="FragranceProductCategoryGrid" class="grid"></div>
  <div id="FragranceProductsNo" class="no-products" style="display:none;">
    No categories available.
  </div>
</section>

<section id="FragranceProductsView" style="display:none;">
  <div class="header-wrapper">
    <h1 id="fragranceProductsTitle">Fragrance</h1>
  </div>

  <div class="search-container">
    <!-- Search input -->
    <div class="search-row full">
      <input type="text" id="searchFragrance" placeholder="Search product...">
    </div>

    <!-- Size only (no color) -->
    <div class="search-row full">
      <select id="filterFragranceSize">
        <option value="">All Sizes</option>
        <option value="30 ml">30 ml</option>
        <option value="50 ml">50 ml</option>
      </select>
    </div>

    <!-- Min + Max side by side -->
    <div class="search-row">
      <input type="number" id="fragranceMinPrice" placeholder="Min Price" min="0">
      <input type="number" id="fragranceMaxPrice" placeholder="Max Price" min="0">
    </div>

    <!-- Clear button -->
    <div class="search-row">
      <button onclick="showFragranceCards()">Back</button>
      <button id="clearFragrance">Clear</button>
    </div>
  </div>

  <div id="FragranceProductsGrid" class="grid"></div>
  <div id="FragranceProductsNo" class="no-products" style="display:none;">
    No products in this category.
  </div>
</section>

<div id="FragranceSizePopup" class="popup-overlay" style="display:none;">
  <div class="popup">
    <button id="FragranceClosePopup" class="close-btn">
      <i class="fas fa-times"></i>
    </button>
    <h3>Size Options Available</h3>
    <div id="FragranceSizeOptions" class="size-options"></div>
    <button id="FragranceConfirmSizeBtn" class="confirm-btn">Add to Cart</button>
  </div>
</div>


  </main>

  <!-- Elfsight Google Reviews -->
<script src="https://elfsightcdn.com/platform.js" async></script>
<div class="elfsight-app-12c65bc7-9246-4ffa-9e19-3775ffd32f2d" data-elfsight-app-lazy style="margin-top: 20px;"></div>

  <footer class="site-footer" style="text-align:center; padding:26px 18px; border-top:3px solid #731a2f; background:#fefef6;">
    <div style="margin-bottom:12px;"><img src="images/logo_red.png" alt="Foyer Studio" style="width:100px;"></div>
    <div class="footer-social" style="margin-bottom:12px;">
      <a href="https://wa.me/912269646641?text=Hi%20Foyer%20Studio" target="_blank"><img src="images/whatsapp.png" alt="WhatsApp" style="width:28px; margin:0 8px;"></a>
      <a href="https://instagram.com/foyerstudio" target="_blank"><img src="images/insta.png" alt="Instagram" style="width:28px; margin:0 8px;"></a>
      <a href="mailto:fashion@foyerstudio.in"><img src="images/mail.png" alt="Email" style="width:28px; margin:0 8px;"></a>
    </div>
    
     <!-- Footer Credits -->
  <div class="footer-credit">
    <p>
      <a href="TC.html">Terms & Conditions</a>
    </p>
    <p>
      <a href="privacy-policy.html">Privacy Policy</a> ¬∑
      <a href="return-policy.html">Return Policy</a> ¬∑
      <a href="shipping-policy.html">Shipping Policy</a>
    </p>
    <p>¬© 2025 Foyer Studio‚Ñ¢ ‚Äî All Rights Reserved.</p>
  </div>
</footer>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>

   function toggleMenu() {
  const icon = document.getElementById('menuIcon');
  const menu = document.getElementById('menu');
  icon.classList.toggle('open');
  menu.classList.toggle('show');
}


    // Firebase config (unchanged)
    const firebaseConfig = {
      apiKey: "AIzaSyAjlHBB46moYAuus9aNb_ZYD_C-duqf7lM",
      authDomain: "foyerstudio-6fa35.firebaseapp.com",
      projectId: "foyerstudio-6fa35",
      storageBucket: "foyerstudio-6fa35.firebasestorage.app",
      messagingSenderId: "406213917569",
      appId: "1:406213917569:web:aba9885f5815cba0f18680",
      measurementId: "G-DSFEHX0LTM"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // fetch inventory - unchanged
  async function fetchInventoryFromFirestore(tab) {
  try {
    const snapshot = await db.collection("Inventory").get();
    const inventory = [];

    snapshot.forEach(doc => {
      const data = { code: doc.id, ...doc.data() };

      // Only include if inStock > 0
      if (Number(data.inStock) > 0) {

        // If tab is empty ‚Üí include everything
        if (!tab || tab.trim() === "") {
          inventory.push(data);
          return; // skip further filters
        }

        // --- TAB FILTER LOGIC ---
        if (tab === "women" && data.code.includes("FS")) {
          inventory.push(data);
        }
        else if (tab === "men" && data.code.includes("FM")) {
          inventory.push(data);
        }
        else if (tab === "fragrance" && data.code.includes("FF")) {
          inventory.push(data);
        }
      }
    });

    console.log(`üì¶ [Inventory] Loaded ${inventory.length} products with inStock > 0`);
    return inventory;

  } catch (err) {
    console.error("‚ùå Error fetching inventory from Firestore:", err);
    return [];
  }
}




    // Size codes and helper (unchanged)
    const SIZE_CODES = ["XXXS","0XXS","00XS","000S","000M","000L","00XL","0XXL","XXXL","0000","0030","0060"];
    function getBaseCode(code = "") { for (let s of SIZE_CODES) if (code.endsWith(s)) return code.slice(0, -s.length); return code; }

    const apiProduct = "https://script.google.com/macros/s/AKfycbwSgPt1bqa11wXfJCzQ1SKxFLGVhVHyr6icSuO6EYmiQgd1t_sSgRrReivvUhKHKdYAmw/exec?type=product";
    const apiInventory = "https://script.google.com/macros/s/AKfycbwSgPt1bqa11wXfJCzQ1SKxFLGVhVHyr6icSuO6EYmiQgd1t_sSgRrReivvUhKHKdYAmw/exec?type=inventory"

    function showLoader(){ document.getElementById('loader').style.display = 'block'; }
    function hideLoader(){ document.getElementById('loader').style.display = 'none'; }

    // openTab - ensures only requested tab is visible and triggers relevant setup
/* ----------------------------------------
   FIXED: Unified Tab Handling + Cleanup
-----------------------------------------*/

function openTab(evt, tabName) {
  console.log("üß≠ openTab:", tabName);

  // Hide all .tabcontent sections
  document.querySelectorAll('.tabcontent').forEach(t => {
    t.classList.remove('active', 'view-enter');
    t.style.display = 'none';
  });

  // Deactivate all tab buttons
  document.querySelectorAll('.tablink').forEach(b => b.classList.remove('active'));

  // --- FIX #1: Clear ALL dynamic grids ---
  [
    'categoryGrid',
    'categoryProductsGrid',
    'MencategoryGrid',
    'MencategoryProductsGrid',
    'FragranceProductCategoryGrid',
    'FragranceProductsGrid'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.innerHTML = '';
  });

  // --- FIX #2: Hide ALL subviews (Fragrance + Category) ---
  [
    'categoryView',
    'categoryProductsView',
    'MencategoryView',
    'MencategoryProductsView',
    'FragranceView',
    'FragranceProductsView'
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });

  // Show selected tabcontent (if it exists)
  const tabEl = document.getElementById(tabName);
  if (tabEl) {
    tabEl.style.display = 'block';
    tabEl.classList.add('active', 'view-enter');
  }

  // Activate clicked button
  if (evt && evt.currentTarget) evt.currentTarget.classList.add('active');

  // Tab-specific actions
  switch (tabName) {
    case 'fragrance':
      showFragranceCards();
      break;

    case 'categoryView':
      showCategoryCards(); // Home
      break;

    case 'MencategoryView':
      showMenCategoryCards(); // Home
      break;
  }

  // Scroll just below header
  const headerHeight = parseInt(
    getComputedStyle(document.documentElement)
      .getPropertyValue('--header-height')
  ) || 88;

  window.scrollTo({ top: headerHeight + 10, behavior: 'smooth' });
}



/* ----------------------------------------
   FIXED: Open Tab From Left Menu
-----------------------------------------*/
function openTabFromMenu(tab) {

  // Remove active class from all tab buttons
  Array.from(document.getElementsByClassName('tablink'))
    .forEach(btn => btn.classList.remove('active'));

  let btn, tabName;

  if (tab === 'fragrance') {
    btn = document.getElementById('tab-fragrance');
    tabName = 'fragrance';

  } else if (tab === 'category') {
    btn = document.getElementById('tab-category-nav');
    tabName = 'categoryView';   // üî• Important: points to Home section
  }
 else if (tab === 'Mencategory') {
    btn = document.getElementById('tab-Mencategory-nav');
    tabName = 'MencategoryView';   // üî• Important: points to Home section
  }

  if (btn) btn.classList.add('active');

  // Open correct tab
  openTab({ currentTarget: btn }, tabName);

  // Close menu drawer
  const menu = document.getElementById('menu');
  const icon = document.getElementById('menuIcon');

  if (menu.classList.contains('show')) {
    menu.classList.remove('show');
    icon.classList.remove('open');
  }
}



/* ----------------------------------------
   FIXED: Home button now just triggers openTab()
-----------------------------------------*/
function openCategoryView() {
  // Home should always go through openTab() for full cleanup
  const btn = document.getElementById("tab-category-nav");
  openTab({ currentTarget: btn }, "categoryView");
  const menu = document.getElementById('menu');
  const icon = document.getElementById('menuIcon');
  if (menu && menu.classList.contains('show')) {
    menu.classList.remove('show');
    if (icon) icon.classList.remove('open');
    menu.setAttribute('aria-hidden', 'true');
  }
}

function openMenCategoryView() {
  // Home should always go through openTab() for full cleanup
  const btn = document.getElementById("tab-Mencategory-nav");
  openTab({ currentTarget: btn }, "MencategoryView");
  const menu = document.getElementById('menu');
  const icon = document.getElementById('menuIcon');
  if (menu && menu.classList.contains('show')) {
    menu.classList.remove('show');
    if (icon) icon.classList.remove('open');
    menu.setAttribute('aria-hidden', 'true');
  }
}


    // helper used by menu to open fragrance (no event)
   function openTabFromMenu(tab) {
  // remove active class from all tab buttons
  Array.from(document.getElementsByClassName('tablink')).forEach(b => b.classList.remove('active'));

  // choose correct button based on tab name
  let btn;
  if (tab === 'fragrance') {
    btn = document.getElementById('tab-fragrance');
  } else if (tab === 'category') {
    btn = document.getElementById('tab-category-nav');
  } 
else if (tab === 'Mencategory') {
    btn = document.getElementById('tab-Mencategory-nav');
  } 
  // activate selected button
  if (btn) btn.classList.add('active');

  // open the correct tab or category view
  if (tab === 'category') {
    openCategoryView();
  }
  else if (tab === 'Mencategory') {
    openMenCategoryView();
  }
   else {
    openTab({ currentTarget: btn }, tab);
  }

  // close the menu if it‚Äôs open
  const menu = document.getElementById('menu');
  const icon = document.getElementById('menuIcon');
  if (menu && menu.classList.contains('show')) {
    menu.classList.remove('show');
    if (icon) icon.classList.remove('open');
    menu.setAttribute('aria-hidden', 'true');
  }
}



    // Global arrays
    let shoppingProducts = [];
    let fragranceProducts = [];
    let allProductsCache = null;

    // Populate filters (size/colors/category JSON) - safe if category select removed
    function populateFiltersFromLocalJSON(callback){
      const sizeFilter = document.getElementById("filterSize");
      const colorFilter = document.getElementById("filterColor");
      const categoryFilter = document.getElementById("filterCategory");
      Promise.all([
        fetch("./JSON/size.json").then(r=>r.json()),
        fetch("./JSON/colors.json").then(r=>r.json()),
        fetch("./JSON/category.json").then(r=>r.json())
      ]).then(([sizes, colors, categories])=>{
        if (sizeFilter){
          sizeFilter.querySelectorAll('option:not(:first-child)').forEach(o=>o.remove());
          sizes.forEach(item=>{
            if (item.size && !String(item.size).toLowerCase().includes("ml")){
              let sizeValue = item.size;
              if (typeof sizeValue === 'number') sizeValue = sizeValue.toString().padStart(4,'0');
              const opt = document.createElement('option'); opt.value = sizeValue; opt.textContent = sizeValue; sizeFilter.appendChild(opt);
            }
          });
        }
        if (colorFilter){
          colorFilter.querySelectorAll('option:not(:first-child)').forEach(o=>o.remove());
          colors.forEach(item=>{
            if (item.color && item.color.toLowerCase() !== "perfume"){
              const opt = document.createElement('option'); opt.value = item.color; opt.textContent = item.color; colorFilter.appendChild(opt);
            }
          });
        }
        if (categoryFilter){
          categoryFilter.querySelectorAll('option:not(:first-child)').forEach(o=>o.remove());
          categories.forEach(item=>{
            if (item.type && !item.type.toLowerCase().includes("eau de")){
              const opt = document.createElement('option'); opt.value = item.type; opt.textContent = item.type; categoryFilter.appendChild(opt);
            }
          });
        }
        if (callback) callback();
      }).catch(err=>{ console.error("Error fetching filters:", err); if (callback) callback(); });
    }

// ---------------- FRAGRANCE MAIN VIEW ----------------
async function showFragranceCards() {
  document.querySelectorAll('.tabcontent').forEach(t => {
    t.classList.remove('active');
    t.style.display = 'none';
  });

  document.getElementById('categoryProductsView').style.display = 'none';
  document.getElementById('FragranceProductsView').style.display = 'none';

  const fv = document.getElementById('FragranceView');
  fv.style.display = 'block';
  fv.classList.add('view-enter');

  const grid = document.getElementById('FragranceProductCategoryGrid');
  grid.innerHTML = '';
  showLoader();

  let products = allProductsCache;
  const inventory = await fetchInventoryFromFirestore('fragrance');
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  if (!Array.isArray(products)) {
    try {
      products = await fetch('./JSON/products.json').then(r => r.json());
      allProductsCache = products;
    } catch { products = []; }
  }

  const fragCatMap = new Map();
  products.forEach(p => {
    if (p.code.includes('FF') && invMap[p.code] > 0 && p.tags) {
      p.tags.split(',').map(t => t.trim()).forEach(tag => {
        if (!fragCatMap.has(tag)) fragCatMap.set(tag, []);
        fragCatMap.get(tag).push(p);

      });
    }
  });

  // ---------------- PRIORITY BASED SORTING ----------------
const priority = {
  "Signature" : 1,
  "New Arrivals": 2,
  "Premium": 3,
  "Men": 4,
  "Women": 5,
  "Unisex": 6,
  "Oriental": 7
};

const sortedTags = Array.from(fragCatMap.keys()).sort((a, b) => {
  const pa = priority[a] || 999;
  const pb = priority[b] || 999;

  if (pa !== pb) return pa - pb;
  return a.localeCompare(b);
});


  const noProductsEl = document.getElementById('FragranceProductsNo');
  if (sortedTags.length === 0) {
    noProductsEl.style.display = 'block';
  } else {
    noProductsEl.style.display = 'none';
    sortedTags.forEach((tag, i) => {
      const list = fragCatMap.get(tag);
      const sampleProd = list[Math.floor(Math.random() * list.length)];
      const card = document.createElement('div');
      card.className = 'product-card category-card';
      card.dataset.category = tag;

      const img = document.createElement('img');
      img.loading = 'lazy';
      const driveFileId = sampleProd.image1;
      img.src = driveFileId
        ? `https://drive.google.com/uc?export=view&id=${driveFileId}`
        : `images/products/${sampleProd.code}/1.jpg`;

      const label = document.createElement('div');
      label.className = 'product-name';
      label.textContent = tag;

      card.appendChild(img);
      card.appendChild(label);
      card.addEventListener('click', () => showProductsForFragrance(tag));
      grid.appendChild(card);
    });
  }

  hideLoader();
}




// ---------------- FRAGRANCE PRODUCTS ----------------
async function showProductsForFragrance(tagName) {

  // Hide other views
  ['FragranceView', 'categoryProductsView', 'shopping', 'categoryView'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });

  const fpv = document.getElementById('FragranceProductsView');
  if (!fpv) {
    return;
  }

  fpv.style.display = 'block';
  fpv.classList.add('view-enter');
  document.getElementById('fragranceProductsTitle').textContent = tagName;

  showLoader();

  // --- Load products and inventory
  let products = allProductsCache;
  const inventory = await fetchInventoryFromFirestore('fragrance');

  const invMap = {};
  inventory.forEach(i => (invMap[i.code] = Number(i.inStock) || 0));

  if (!Array.isArray(products)) {
    try {

      products = await fetch('./JSON/products.json').then(r => r.json());
      allProductsCache = products;
    } catch (err) {
      products = [];
    }
  }


  // --- Filter only PF products matching tag
  const tagProducts = products.filter(p =>
    p.code?.includes('FF') &&
    invMap[p.code] > 0 &&
    p.tags?.split(',').map(t => t.trim()).includes(tagName)
  );

  // --- Deduplicate
  const deduped = [];
  const seen = new Set();
  tagProducts.forEach(p => {
    const base = getBaseCode(p.code);
    if (!seen.has(base)) {
      seen.add(base);
      deduped.push(p);
    }
  });
  // --- Render to grid
  const gridEl = document.getElementById('fragranceGrid') || document.getElementById('FragranceProductsGrid');
  if (!gridEl) {
    hideLoader();
    return;
  }

  // --- Initialize cart
  initCartButtons();
  updateAllCartButtons();
  

  // --- Show 'no products' message if applicable
  const noEl = document.getElementById('fragranceNoProducts') || document.getElementById('FragranceProductsNo');
  if (noEl) {
    noEl.style.display = deduped.length === 0 ? 'block' : 'none';
  }

  hideLoader();

  // --- Setup & restore filters
  
   setupFragranceFiltersAndSearch(tagProducts, 'fragrance_' + tagName, tagName);

  window.scrollTo({ top: parseInt(getComputedStyle(document.documentElement)
    .getPropertyValue('--header-height')) + 10, behavior: 'smooth' });
}



   // ---------------- CATEGORY VIEW ----------------
async function showCategoryCards() {
  document.querySelectorAll('.tabcontent').forEach(t => {
    t.classList.remove('active');
    t.style.display = 'none';
  });

  document.getElementById('categoryProductsView').style.display = 'none';
  const cv = document.getElementById('categoryView');
  cv.style.display = 'block';
  cv.classList.add('view-enter');

  const catGrid = document.getElementById('categoryGrid');
  catGrid.innerHTML = '';

  showLoader();

  let products = allProductsCache;
  const inventory = await fetchInventoryFromFirestore('women');
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  if (!Array.isArray(products)) {
    try {
      products = await fetch('./JSON/products.json').then(r => r.json());
      allProductsCache = products;
    } catch { products = []; }
  }

  const catMap = new Map();
  products.forEach(p => {
    if (p.code.includes('FF') || p.code.includes('FM')) return;
    if (invMap[p.code] > 0 && p.tags) {
      p.tags.split(',').map(t => t.trim()).forEach(tag => {
        if (!catMap.has(tag)) catMap.set(tag, []);
catMap.get(tag).push(p);

      });
    }
  });

  const sortedCategories = Array.from(catMap.keys()).sort((a, b) => {
    if (a === 'New Arrivals') return -1;
    if (b === 'New Arrivals') return 1;
    if (a.includes('Premium') && !b.includes('Premium')) return -1;
    if (!a.includes('Premium') && b.includes('Premium')) return 1;
    return a.localeCompare(b);
  });

  if (sortedCategories.length === 0) {
    document.getElementById('categoryNoProducts').style.display = 'block';
  } else {
    document.getElementById('categoryNoProducts').style.display = 'none';
    sortedCategories.forEach((tag, i) => {
      const list = catMap.get(tag);
const sampleProd = list[Math.floor(Math.random() * list.length)];
      const card = document.createElement('div');
      card.className = 'product-card category-card';
      card.dataset.category = tag;

      const img = document.createElement('img');
      img.loading = 'lazy';
      const driveFileId = sampleProd.image1;
      img.src = driveFileId
        ? `https://drive.google.com/uc?export=view&id=${driveFileId}`
        : `images/products/${sampleProd.code}/1.jpg`;
      img.alt = tag;

      const label = document.createElement('div');
      label.className = 'product-name';
      label.textContent = tag;

      card.appendChild(img);
      card.appendChild(label);
      card.style.setProperty('--i', i);
      card.addEventListener('click', () => showProductsForCategory(tag));
      catGrid.appendChild(card);
    });
  }

  hideLoader();
  document.getElementById('FragranceView').style.display = 'none';
  window.scrollTo({ top: parseInt(getComputedStyle(document.documentElement)
    .getPropertyValue('--header-height')) + 10, behavior: 'smooth' });
}



  // ---------------- CATEGORY PRODUCTS ----------------
async function showProductsForCategory(categoryName) {
  document.getElementById('categoryView').style.display = 'none';
  const cpv = document.getElementById('categoryProductsView');
  cpv.style.display = 'block';
  cpv.classList.add('view-enter');
  document.getElementById('categoryProductsTitle').textContent = categoryName;

  showLoader();

  let products = allProductsCache;
  const inventory = await fetchInventoryFromFirestore('women');
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  if (!Array.isArray(products)) {
    try {
      products = await fetch('./JSON/products.json').then(r => r.json());
      allProductsCache = products;
    } catch { products = []; }
  }

  const categoryProducts = products.filter(p =>
    !p.code.includes('FF') && !p.code.includes('FM') &&
    invMap[p.code] > 0 &&
    p.tags?.split(',').map(t => t.trim()).includes(categoryName)
  );

  const dedupedProducts = [];
  const seenBase = new Set();
  categoryProducts.forEach(p => {
    const base = getBaseCode(p.code);
    if (!seenBase.has(base)) {
      seenBase.add(base);
      dedupedProducts.push(p);
    }
  });

  initCartButtons();
  updateAllCartButtons();

  document.getElementById('categoryProductsNo').style.display =
    dedupedProducts.length === 0 ? 'block' : 'none';

  hideLoader();
  setupCategoryFiltersAndSearch(categoryProducts, categoryName);

  window.scrollTo({ top: parseInt(getComputedStyle(document.documentElement)
    .getPropertyValue('--header-height')) + 10, behavior: 'smooth' });
}


  // ---------------- CATEGORY VIEW ----------------
async function showMenCategoryCards() {
  document.querySelectorAll('.tabcontent').forEach(t => {
    t.classList.remove('active');
    t.style.display = 'none';
  });

  document.getElementById('MencategoryProductsView').style.display = 'none';
  const cv = document.getElementById('MencategoryView');
  cv.style.display = 'block';
  cv.classList.add('view-enter');

  const catGrid = document.getElementById('MencategoryGrid');
  catGrid.innerHTML = '';

  showLoader();

  let products = allProductsCache;
  const inventory = await fetchInventoryFromFirestore('men');
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  if (!Array.isArray(products)) {
    try {
      products = await fetch('./JSON/products.json').then(r => r.json());
      allProductsCache = products;
    } catch { products = []; }
  }

  const catMap = new Map();
  products.forEach(p => {
    if (!p.code.includes('FM')) return;
    if (invMap[p.code] > 0 && p.tags) {
      p.tags.split(',').map(t => t.trim()).forEach(tag => {
        if (!catMap.has(tag)) catMap.set(tag, []);
catMap.get(tag).push(p);
      });
    }
  });

  const priority = {
  "New Arrivals": 1,
  "Top Wear": 2,
  "Bottoms": 3
};

const sortedCategories = Array.from(catMap.keys()).sort((a, b) => {
  const pa = priority[a] || 999;  
  const pb = priority[b] || 999;

  if (pa !== pb) return pa - pb;
  return a.localeCompare(b); // alphabetical for others
});


  if (sortedCategories.length === 0) {
    document.getElementById('MencategoryNoProducts').style.display = 'block';
  } else {
    document.getElementById('MencategoryNoProducts').style.display = 'none';
    sortedCategories.forEach((tag, i) => {
      const list = catMap.get(tag);
const sampleProd = list[Math.floor(Math.random() * list.length)];
      const card = document.createElement('div');
      card.className = 'product-card category-card';
      card.dataset.category = tag;

      const img = document.createElement('img');
      img.loading = 'lazy';
      const driveFileId = sampleProd.image1;
      img.src = driveFileId
        ? `https://drive.google.com/uc?export=view&id=${driveFileId}`
        : `images/products/${sampleProd.code}/1.jpg`;
      img.alt = tag;

      const label = document.createElement('div');
      label.className = 'product-name';
      label.textContent = tag;

      card.appendChild(img);
      card.appendChild(label);
      card.style.setProperty('--i', i);
      card.addEventListener('click', () => showProductsForMenCategory(tag));
      catGrid.appendChild(card);
    });
  }

  hideLoader();
  document.getElementById('FragranceView').style.display = 'none';
  document.getElementById('categoryView').style.display = 'none';
  window.scrollTo({ top: parseInt(getComputedStyle(document.documentElement)
    .getPropertyValue('--header-height')) + 10, behavior: 'smooth' });
}



  // ---------------- CATEGORY PRODUCTS ----------------
async function showProductsForMenCategory(categoryName) {
  document.getElementById('MencategoryView').style.display = 'none';
  const cpv = document.getElementById('MencategoryProductsView');
  cpv.style.display = 'block';
  cpv.classList.add('view-enter');
  document.getElementById('MencategoryProductsTitle').textContent = categoryName;

  showLoader();

  let products = allProductsCache;
  const inventory = await fetchInventoryFromFirestore('men');
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  if (!Array.isArray(products)) {
    try {
      products = await fetch('./JSON/products.json').then(r => r.json());
      allProductsCache = products;
    } catch { products = []; }
  }

  const categoryProducts = products.filter(p =>
    p.code.includes('FM') &&
    invMap[p.code] > 0 &&
    p.tags?.split(',').map(t => t.trim()).includes(categoryName)
  );

  const dedupedProducts = [];
  const seenBase = new Set();
  categoryProducts.forEach(p => {
    const base = getBaseCode(p.code);
    if (!seenBase.has(base)) {
      seenBase.add(base);
      dedupedProducts.push(p);
    }
  });

  initCartButtons();
  updateAllCartButtons();

  document.getElementById('MencategoryProductsNo').style.display =
    dedupedProducts.length === 0 ? 'block' : 'none';

  hideLoader();
  setupMenCategoryFiltersAndSearch(categoryProducts, categoryName);

  window.scrollTo({ top: parseInt(getComputedStyle(document.documentElement)
    .getPropertyValue('--header-height')) + 10, behavior: 'smooth' });
}


// ------------------- Global Coupon Cache -------------------
let couponsCache = null;

async function fetchCouponCodes() {
  try {
    const snapshot = await db.collection("CouponCode")
      .where("status", "==", "ACTIVE") // only active coupons
      .get();

    const coupons = [];
    snapshot.forEach(doc => {
      const data = doc.data();
      coupons.push({
        code: data.code,
        ...data
      });
    });

    // Filter out COMBO coupons
    const filteredCoupons = coupons.filter(coupon => !coupon.code.includes("COMBO"));

    return filteredCoupons;

  } catch (error) {
    console.error("Error fetching coupons:", error);
    return [];
  }
}



async function getCoupons() {
  if (couponsCache) return couponsCache; // Return cached coupons

  try {
    couponsCache = await fetchCouponCodes(); // Fetch once
  } catch (err) {
    couponsCache = [];
  }
  return couponsCache;
}

// Schedule cache reset at 1 AM every day
function scheduleCouponCacheReset() {
  const now = new Date();
  const nextReset = new Date();
  nextReset.setHours(1, 0, 0, 0); // 1 AM
  if (now >= nextReset) nextReset.setDate(nextReset.getDate() + 1);

  const delay = nextReset - now;
  setTimeout(() => {
    couponsCache = null;
    scheduleCouponCacheReset(); // reschedule for next day
  }, delay);
}
scheduleCouponCacheReset();



async function renderProductsToGrid(products, gridEl, context = '', categoryName = '') {
  if (!gridEl) return;
  gridEl.innerHTML = '';

  const coupons = await getCoupons(); // Use cached coupons

  const getDiscountedPrice = (productCode, originalPriceRaw, coupons = []) => {
    const originalPrice = Number(originalPriceRaw);
    if (isNaN(originalPrice)) return 0;

    let finalPrice = originalPrice;
    const normalizedCode = productCode.toUpperCase().trim();

    if (!Array.isArray(coupons) || coupons.length === 0) {
      return finalPrice;
    }

    // Filter coupons that apply to this product
    const applicableCoupons = coupons.filter(coupon => {
      const couponDisc = Number(coupon.discInPct);
      if (isNaN(couponDisc)) return false;

      const productList = coupon.products === "All Products"
        ? null
        : coupon.products.split(',').map(x => x.trim().toUpperCase());

      return !productList || productList.includes(normalizedCode);
    });

    console.log(`‚Ä¢ Applicable Coupons: ${applicableCoupons.length}`);
    if (applicableCoupons.length === 0) {
      return finalPrice;
    }

    // Apply best discount
    applicableCoupons.forEach(coupon => {
      const couponDisc = Number(coupon.discInPct);
      const isFlat = coupon.code.toUpperCase().includes("FLAT");


      const discounted = isFlat
        ? originalPrice - couponDisc
        : originalPrice * (1 - couponDisc / 100);


      if (discounted < finalPrice) {
        finalPrice = discounted;
      } else {
      }
    });

    return Math.round(finalPrice);
  };

  // Precompute discounted prices first
  const productsWithDiscount = products.map(p => {
    const discounted = getDiscountedPrice(p.code, p.sellingPrice, coupons);
    return { ...p, discountedPrice: discounted };
  });

  productsWithDiscount.forEach((p, idx) => {
    // --- Create product card container
    const card = document.createElement('div');
    card.className = 'product-card';
    card.dataset.code = p.code || '';

    // --- Create image wrapper
    const imgWrapper = document.createElement('div');
    imgWrapper.className = 'product-image';

    // --- Create and load product image
    const img = document.createElement('img');
    img.loading = 'lazy';
    const driveFileId = p.image1;
    img.src = driveFileId
      ? `https://drive.google.com/uc?export=view&id=${driveFileId}`
      : `images/products/${p.code}/1.jpg`;
    img.alt = p.name || 'Product';

    // --- Create cart icon button (bottom-right of image)
    const cartBtn = document.createElement('button');
    cartBtn.className = 'cart-btn';
    cartBtn.innerHTML = '<i class="fa-solid fa-cart-plus"></i>';
    cartBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent opening product details
      openSizePopup(p); // Custom function for popup
      console.log(`üõí [Cart] Opened size popup for:`, p.code);
    });

    // Append image and cart button inside wrapper
    imgWrapper.appendChild(img);
    imgWrapper.appendChild(cartBtn);

    // --- Product Name
    const name = document.createElement('div');
    name.className = 'product-name';
    name.textContent = p.name || '';

    const price = document.createElement('div');
    price.className = 'product-price';
    if (p.discountedPrice < p.sellingPrice) {
      price.innerHTML = `<span class="original-price">‚Çπ${p.sellingPrice}</span> ‚Çπ${p.discountedPrice}`;
    } else {
      price.textContent = `‚Çπ${p.sellingPrice}`;
    }

    // --- Add elements to card
    card.appendChild(imgWrapper);
    card.appendChild(name);
    card.appendChild(price);

    // --- Handle redirection logic
    const codeLower = (p.code || '').toLowerCase();

    // Build query params dynamically
    const params = new URLSearchParams();
    params.set('code', p.code);
    if (context) params.set('from', context);

    // Attach tag or category based on context


    if (context === 'category' && categoryName) {
      params.set('category', categoryName);
    } else if (context === 'fragrance' && categoryName) {
      params.set('category', categoryName);
    }else if (context === 'Mencategory' && categoryName) {
      params.set('Mencategory', categoryName);
    }

    const handleClick = (detailPage) => {
      // Store tab and tag/category for back navigation
      sessionStorage.setItem('fromTab', context || 'shopping');

      if (context === 'category' && categoryName) {
        sessionStorage.setItem('fromCategoryName', categoryName);
      } else if (context === 'fragrance' && categoryName) {
        sessionStorage.setItem('fromFragranceTag', categoryName);
      }
      else if (context === 'Mencategory' && categoryName) {
        sessionStorage.setItem('fromMenCategoryName', categoryName);
      }

      // Redirect to the appropriate detail page
      window.location.href = `${detailPage}?${params.toString()}`;
    };

    // Decide which detail page
    if (codeLower.includes('ff')) {
      card.addEventListener('click', () => handleClick('fragrance-details.html'));
    } else {
      card.addEventListener('click', () => handleClick('shopping-details.html'));
    }

    // --- Optional: animation index variable
    card.style.setProperty('--i', idx);

    // --- Finally, append card to grid container
    gridEl.appendChild(card);
  });

   // Update cart buttons
  initCartButtons();
  updateAllCartButtons();
}



function initCartButtons() {
  const cart = getCart() || [];
  cart.forEach(item => {
    // Find the product card button for this code
    const cardBtn = document.querySelector(`.product-card[data-code="${item.code}"] .cart-btn`);
    if (cardBtn) cardBtn.disabled = true;
  });
}


let selectedProduct = null;
let selectedSizeCode = null;

async function openSizePopup(product) {
  const popup = document.getElementById('sizePopup');
  const sizeOptions = document.getElementById('sizeOptions');
  const closeBtn = document.getElementById('closePopup');
  const confirmBtn = document.getElementById('confirmSizeBtn');

  // Reset selection
  selectedProduct = null;
  selectedSizeCode = null;
  confirmBtn.disabled = true;
  confirmBtn.textContent = 'Select Size';
  sizeOptions.innerHTML = 'Loading...';
  popup.style.display = 'flex';

  // Get all sizes for this base product
  const baseCode = getBaseCode(product.code);
  const all = allProductsCache.filter(p => p.code.startsWith(baseCode));

  // Fetch inventory
  const inventory = await fetchInventoryFromFirestore('');
  const invMap = {};
  inventory.forEach(i => invMap[i.code] = Number(i.inStock) || 0);

  const available = all.filter(p => invMap[p.code] > 0);

  const sizeMap = {
    "XXXS":"XXXS","0XXS":"XXS","00XS":"XS","000S":"S","000M":"M",
    "000L":"L","00XL":"XL","0XXL":"XXL","XXXL":"XXXL",
    "0000":"UnStitched","0029":"30 ml","0060":"60 ml","0030":"30","0032":"32","0034":"34","0036":"36"};

  sizeOptions.innerHTML = '';

  if (available.length === 0) {
    sizeOptions.innerHTML = '<p style="color:#731a2f;">No sizes available</p>';
  } else {
    available.forEach(p => {
      const btn = document.createElement('button');
      const sizeSuffix = p.code.slice(-4);
      btn.textContent = sizeMap[sizeSuffix] || sizeSuffix;

      btn.addEventListener('click', () => {
        // Highlight selected size
        document.querySelectorAll('#sizeOptions button').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');

        selectedProduct = p;
        selectedSizeCode = p.code;

        // Enable confirm button
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Add to Cart';
      });

      sizeOptions.appendChild(btn);
    });
  }

  // Close popup
  closeBtn.onclick = () => popup.style.display = 'none';

  // Confirm selection
  confirmBtn.onclick = () => {
    if (!selectedProduct) return;

    // Add product to cart
    toggleCartFromGrid(selectedProduct);

    const imgSrc = selectedProduct.image1
    ? `https://drive.google.com/uc?export=view&id=${selectedProduct.image1}`
    : `images/products/${selectedProduct.code}/1.jpg`;
  animateToCart(imgSrc);

    // Disable add-to-cart button on the product card
    const cardBtn = document.querySelector(`.product-card[data-code="${selectedProduct.code}"] .cart-btn`);
    if (cardBtn) cardBtn.disabled = true;

    popup.style.display = 'none';
  };
}





  // Close popup
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('closePopup').addEventListener('click', closePopup);
    document.getElementById('confirmSizeBtn').addEventListener('click', closePopup);
  });

  function closePopup() {
    document.getElementById('sizePopup').style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  // Optional: close on click outside popup
  document.getElementById('sizePopup').addEventListener('click', (e) => {
    if (e.target.id === 'sizePopup') closePopup();
  });

function toggleCartFromGrid(prod) {
  let cart = getCart() || [];
  const idx = cart.findIndex(item => item.code === prod.code);

  if (idx >= 0) {
    // Remove from cart
    cart.splice(idx, 1);
  } else if (cart.length < 3) {
    // Add to cart

if (!prod.code.includes("FF")){
  cart.push({
      code: prod.code,
      name: prod.name,
      price: prod.sellingPrice,
      img: prod.image1 ? `https://drive.google.com/uc?export=view&id=${prod.image1}` : '',
      size: prod.size || '-',
      color: prod.color || '-',
      quantity: 1
    });
}else{
   cart.push({
      code: prod.code,
      name: prod.name,
      price: prod.sellingPrice,
      img: prod.image1 ? `https://drive.google.com/uc?export=view&id=${prod.image1}` : '',
      size: prod.size || '-',
      quantity: 1
    });
}

   

fbq('track', 'AddToCart', {
    content_ids: [prod.code],
    content_type: 'product',
    value: prod.sellingPrice,
    currency: 'INR'
  });

  }

  // Save cart
  localStorage.setItem('cart', JSON.stringify(cart));

  // Update cart tab count
  updateCartTabCount(cart);

  // Update all product buttons instantly
  updateAllCartButtons();
}


function animateToCart(productImageSrc) {
  const cartTab = document.querySelector('#tab-cart, #cartTab');
  if (!cartTab) return;

  // Create image element
  const img = document.createElement('img');
  img.src = productImageSrc;
  img.className = 'fly-image';
  document.body.appendChild(img);

  // Get cart position
  const cartRect = cartTab.getBoundingClientRect();
  const startX = window.innerWidth / 2;
  const startY = window.innerHeight / 2;
  const endX = cartRect.left + cartRect.width / 2;
  const endY = cartRect.top + cartRect.height / 2;

  // Play woosh sound
  const audio = new Audio('sounds/woosh.mp3');
  audio.volume = 0.3; // gentle volume
  audio.play().catch(() => {}); // ignore autoplay restriction

  // Animate flight
  img.animate(
    [
      { transform: `translate(-50%, -50%) scale(1)`, opacity: 1 },
      {
        transform: `translate(${endX - startX}px, ${endY - startY}px) scale(0.15)`,
        opacity: 0.1
      }
    ],
    {
      duration: 4000, // slower, smoother
      easing: 'cubic-bezier(0.22, 1, 0.36, 1)', // easeOutBack-like curve
      fill: 'forwards'
    }
  ).onfinish = () => img.remove();

  // Optional: make the cart pulse when image reaches
  setTimeout(() => {
    cartTab.classList.add('cart-pulse');
    setTimeout(() => cartTab.classList.remove('cart-pulse'), 500);
  }, 1900);
}



function updateAllCartButtons() {
  const cart = getCart() || [];
  const cartBaseCodes = cart.map(item => getBaseCode(item.code)); // base codes in cart
  const cartLength = cart.length;

  const buttons = document.querySelectorAll('.product-card .cart-btn');

  buttons.forEach(btn => {
    const productCode = btn.closest('.product-card').dataset.code;
    const baseCode = getBaseCode(productCode);

    const inCart = cartBaseCodes.includes(baseCode);

    if (inCart) {
      // Any size of this base product is in cart ‚Üí disable button
      btn.disabled = true;
    } else if (cartLength >= 3) {
      // Cart full ‚Üí disable others
      btn.disabled = true;
    } else {
      btn.disabled = false;
    }
  });
}


function getBaseCode(code) {
  // Remove last 4 characters (size suffix)
  return code.slice(0, -4);
}



function getCart() {
  try {
    return JSON.parse(localStorage.getItem('cart') || "[]");
  } catch {
    return [];
  }
}


function updateCartTabCount(cart) {
  const total = cart.reduce((sum, i) => sum + (i.quantity || 1), 0);
  const cartTab = document.getElementById('cartTab');
  if (cartTab) {
    cartTab.textContent = total > 0 ? `Cart (${total})` : "Cart";
  }
}


  function setupCategoryFiltersAndSearch(allProducts, categoryName, initialVisible) {
  const grid = document.getElementById('categoryProductsGrid');
  const searchInput = document.getElementById('searchCategory');
  const sizeSelect = document.getElementById('filterCategorySize');
  const colorSelect = document.getElementById('filterCategoryColor'); // Added
  const minInput = document.getElementById('categoryPriceMin');
  const maxInput = document.getElementById('categoryPriceMax');
  const clearBtn = document.getElementById('clearCategoryFilters');
  const noEl = document.getElementById('categoryProductsNo');

  if (!grid || !searchInput || !sizeSelect || !colorSelect || !minInput || !maxInput || !clearBtn) return;

  // --- category key for localStorage
  const catKey = (categoryName || 'default').toLowerCase().replace(/\s+/g, '_');

  // --- Populate size and color dynamically based on available products
  function populateFilters() {
    const sizes = Array.from(new Set(allProducts.map(p => p.size).filter(Boolean))).sort();
    sizeSelect.innerHTML = '<option value="">All Sizes</option>';
    sizes.forEach(s => sizeSelect.appendChild(new Option(s, s)));

    const colors = Array.from(new Set(allProducts.map(p => p.color).filter(Boolean))).sort();
    colorSelect.innerHTML = '<option value="">All Colors</option>';
    colors.forEach(c => colorSelect.appendChild(new Option(c, c)));
  }
  populateFilters();

  // --- save filters
  function storeCategoryFilters() {
    localStorage.setItem(`${catKey}_search`, searchInput.value || "");
    localStorage.setItem(`${catKey}_size`, sizeSelect.value || "");
    localStorage.setItem(`${catKey}_color`, colorSelect.value || "");
    localStorage.setItem(`${catKey}_minPrice`, minInput.value || "");
    localStorage.setItem(`${catKey}_maxPrice`, maxInput.value || "");
  }

  // --- restore filters
  function restoreCategoryFilters() {
    searchInput.value = localStorage.getItem(`${catKey}_search`) || "";
    sizeSelect.value = localStorage.getItem(`${catKey}_size`) || "";
    colorSelect.value = localStorage.getItem(`${catKey}_color`) || "";
    minInput.value = localStorage.getItem(`${catKey}_minPrice`) || "";
    maxInput.value = localStorage.getItem(`${catKey}_maxPrice`) || "";
  }

  // --- filtering logic
  function applyFilters() {
    const searchText = (searchInput.value || '').toLowerCase().trim();
    const selectedSize = (sizeSelect.value || '').toLowerCase().trim();
    const selectedColor = (colorSelect.value || '').toLowerCase().trim();
    const min = parseFloat(minInput.value) || 0;
    const max = parseFloat(maxInput.value) || Infinity;

    const filteredAll = allProducts.filter(p => {
      const nameMatch = ((p.name || '') + ' ' + (p.code || '')).toLowerCase().includes(searchText);
      const sizeMatch = !selectedSize || (p.size || '').toLowerCase() === selectedSize;
      const colorMatch = !selectedColor || (p.color || '').toLowerCase() === selectedColor;
      const price = parseFloat(p.sellingPrice) || 0;
      const priceMatch = price >= min && price <= max;
      return nameMatch && sizeMatch && colorMatch && priceMatch;
    });

    let finalList;
    if (!selectedSize) {
      const seen = new Set();
      finalList = filteredAll.filter(p => {
        const base = getBaseCode(p.code);
        if (seen.has(base)) return false;
        seen.add(base);
        return true;
      });
    } else {
      finalList = filteredAll;
    }

    renderProductsToGrid(finalList, grid, 'category', categoryName);
    initCartButtons();
    updateAllCartButtons();
    noEl.style.display = (!finalList || finalList.length === 0) ? 'block' : 'none';
  }

  // --- attach events
  [searchInput, sizeSelect, colorSelect, minInput, maxInput].forEach(el => {
    if (!el) return;
    el.removeEventListener('input', applyFilters);
    el.addEventListener('input', () => {
      applyFilters();
      storeCategoryFilters();
    });
  });

  clearBtn.removeEventListener('click', applyFilters);
  clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    sizeSelect.value = '';
    colorSelect.value = '';
    minInput.value = '';
    maxInput.value = '';
    applyFilters();
    storeCategoryFilters();
  });

  restoreCategoryFilters();
  applyFilters();
}


 function setupMenCategoryFiltersAndSearch(allProducts, categoryName, initialVisible) {
  const grid = document.getElementById('MencategoryProductsGrid');
  const searchInput = document.getElementById('MensearchCategory');
  const sizeSelect = document.getElementById('MenfilterCategorySize');
  const colorSelect = document.getElementById('MenfilterCategoryColor'); // Added
  const minInput = document.getElementById('MencategoryPriceMin');
  const maxInput = document.getElementById('MencategoryPriceMax');
  const clearBtn = document.getElementById('clearMenCategoryFilters');
  const noEl = document.getElementById('MencategoryProductsNo');

  if (!grid || !searchInput || !sizeSelect || !colorSelect || !minInput || !maxInput || !clearBtn) return;

  // --- category key for localStorage
  const catKey = (categoryName || 'default').toLowerCase().replace(/\s+/g, '_');

  // --- Populate size and color dynamically based on available products
  function populateMenFilters() {
    const sizes = Array.from(new Set(allProducts.map(p => p.size).filter(Boolean))).sort();
    sizeSelect.innerHTML = '<option value="">All Sizes</option>';
    sizes.forEach(s => sizeSelect.appendChild(new Option(s, s)));

    const colors = Array.from(new Set(allProducts.map(p => p.color).filter(Boolean))).sort();
    colorSelect.innerHTML = '<option value="">All Colors</option>';
    colors.forEach(c => colorSelect.appendChild(new Option(c, c)));
  }
  populateMenFilters();

  // --- save filters
  function storeMenCategoryFilters() {
    localStorage.setItem(`${catKey}_search`, searchInput.value || "");
    localStorage.setItem(`${catKey}_size`, sizeSelect.value || "");
    localStorage.setItem(`${catKey}_color`, colorSelect.value || "");
    localStorage.setItem(`${catKey}_minPrice`, minInput.value || "");
    localStorage.setItem(`${catKey}_maxPrice`, maxInput.value || "");
  }

  // --- restore filters
  function restoreMenCategoryFilters() {
    searchInput.value = localStorage.getItem(`${catKey}_search`) || "";
    sizeSelect.value = localStorage.getItem(`${catKey}_size`) || "";
    colorSelect.value = localStorage.getItem(`${catKey}_color`) || "";
    minInput.value = localStorage.getItem(`${catKey}_minPrice`) || "";
    maxInput.value = localStorage.getItem(`${catKey}_maxPrice`) || "";
  }

  // --- filtering logic
  function applyMenFilters() {
    const searchText = (searchInput.value || '').toLowerCase().trim();
    const selectedSize = (sizeSelect.value || '').toLowerCase().trim();
    const selectedColor = (colorSelect.value || '').toLowerCase().trim();
    const min = parseFloat(minInput.value) || 0;
    const max = parseFloat(maxInput.value) || Infinity;

    const filteredAll = allProducts.filter(p => {
      const nameMatch = ((p.name || '') + ' ' + (p.code || '')).toLowerCase().includes(searchText);
      const sizeMatch = !selectedSize || (p.size || '').toLowerCase() === selectedSize;
      const colorMatch = !selectedColor || (p.color || '').toLowerCase() === selectedColor;
      const price = parseFloat(p.sellingPrice) || 0;
      const priceMatch = price >= min && price <= max;
      return nameMatch && sizeMatch && colorMatch && priceMatch;
    });

    let finalList;
    if (!selectedSize) {
      const seen = new Set();
      finalList = filteredAll.filter(p => {
        const base = getBaseCode(p.code);
        if (seen.has(base)) return false;
        seen.add(base);
        return true;
      });
    } else {
      finalList = filteredAll;
    }

    
    renderProductsToGrid(finalList, grid, 'Mencategory', categoryName);
    initCartButtons();
    updateAllCartButtons();
    noEl.style.display = (!finalList || finalList.length === 0) ? 'block' : 'none';
  }

  // --- attach events
  [searchInput, sizeSelect, colorSelect, minInput, maxInput].forEach(el => {
    if (!el) return;
    el.removeEventListener('input', applyMenFilters);
    el.addEventListener('input', () => {
      applyMenFilters();
      storeMenCategoryFilters();
    });
  });

  clearBtn.removeEventListener('click', applyMenFilters);
  clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    sizeSelect.value = '';
    colorSelect.value = '';
    minInput.value = '';
    maxInput.value = '';
    applyMenFilters();
    storeMenCategoryFilters();
  });

  restoreMenCategoryFilters();
  applyMenFilters();
}





    // MENU toggle
    function toggleMenu(){
      const menu = document.getElementById('menu'); const icon = document.getElementById('menuIcon');
      if (!menu) return;
      menu.classList.toggle('show'); icon.classList.toggle('open');
      if (menu.classList.contains('show')) { menu.querySelectorAll('a').forEach((a,i)=>a.style.setProperty('--i', i)); menu.setAttribute('aria-hidden','false'); }
      else menu.setAttribute('aria-hidden','true');
    }

 function setupFragranceFiltersAndSearch(allProducts, product, tagName) {
  const grid = document.getElementById('FragranceProductsGrid');
  const searchInput = document.getElementById('searchFragrance');
  const sizeSelect = document.getElementById('filterFragranceSize');
  const minInput = document.getElementById('fragranceMinPrice');
  const maxInput = document.getElementById('fragranceMaxPrice');
  const clearBtn = document.getElementById('clearFragrance');
  const noEl = document.getElementById('FragranceProductsNo');

  if (!grid || !searchInput || !sizeSelect || !minInput || !maxInput || !clearBtn) return;

  // ‚úÖ Shared static key across all fragrance categories
  const key = 'fragrance_global_filters';

  // --- Populate sizes dynamically
  function populateSizeOptions() {
    const sizes = Array.from(new Set(allProducts.map(p => p.size).filter(Boolean))).sort();
    sizeSelect.innerHTML = '<option value="">All Sizes</option>';
    sizes.forEach(size => sizeSelect.appendChild(new Option(size, size)));

    // If a previously selected size doesn‚Äôt exist in this category, fallback to ‚ÄúAll Sizes‚Äù
    const savedSize = localStorage.getItem(`${key}_size`) || '';
    if (savedSize && !sizes.includes(savedSize)) {
      sizeSelect.value = '';
    } else {
      sizeSelect.value = savedSize;
    }
  }
  populateSizeOptions();

  // --- Save filters to localStorage
  function storeFilters() {
    localStorage.setItem(`${key}_search`, searchInput.value || '');
    localStorage.setItem(`${key}_size`, sizeSelect.value || '');
    localStorage.setItem(`${key}_min`, minInput.value || '');
    localStorage.setItem(`${key}_max`, maxInput.value || '');
    console.log(`Stored [Fragrance Shared Filters] => size: ${sizeSelect.value || 'All'}, min: ${minInput.value}, max: ${maxInput.value}, search: ${searchInput.value}`);
  }

  // --- Restore filters from localStorage
  function restoreFilters() {
    searchInput.value = localStorage.getItem(`${key}_search`) || '';
    minInput.value = localStorage.getItem(`${key}_min`) || '';
    maxInput.value = localStorage.getItem(`${key}_max`) || '';
  }

  // --- Core filter logic
  function applyFilters() {
    const searchText = (searchInput.value || '').toLowerCase().trim();
    const selectedSize = (sizeSelect.value || '').toLowerCase().trim();
    const min = parseFloat(minInput.value) || 0;
    const max = parseFloat(maxInput.value) || Infinity;

    const filtered = allProducts.filter(p => {
      const sizeMatch = !selectedSize || (p.size || '').toLowerCase() === selectedSize;
      const price = parseFloat(p.sellingPrice) || 0;
      const priceMatch = price >= min && price <= max;
      const textMatch = ((p.name || '') + ' ' + (p.code || '')).toLowerCase().includes(searchText);
      return sizeMatch && priceMatch && textMatch;
    });

    let finalList;
    if (!selectedSize) {
      const seen = new Set();
      finalList = filtered.filter(p => {
        const base = getBaseCode(p.code);
        if (seen.has(base)) return false;
        seen.add(base);
        return true;
      });
    } else {
      finalList = filtered;
    }

    renderProductsToGrid(finalList, grid, 'fragrance', tagName);
    initCartButtons();
    updateAllCartButtons();

    noEl.style.display = filtered.length === 0 ? 'block' : 'none';
    storeFilters();
  }

  // --- Event bindings
  [searchInput, sizeSelect, minInput, maxInput].forEach(el => {
    if (!el) return;
    el.removeEventListener('input', applyFilters);
    el.addEventListener('input', applyFilters);
  });

  clearBtn.removeEventListener('click', applyFilters);
  clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    sizeSelect.value = '';
    minInput.value = '';
    maxInput.value = '';
    applyFilters();
    storeFilters();
  });

  restoreFilters();
  applyFilters();

  // Debug: show current shared filter values
  console.group('[Fragrance Shared Filters]');
  console.log('Search:', localStorage.getItem(`${key}_search`) || '');
  console.log('Size:', localStorage.getItem(`${key}_size`) || 'All');
  console.log('Min:', localStorage.getItem(`${key}_min`) || '');
  console.log('Max:', localStorage.getItem(`${key}_max`) || '');
  console.groupEnd();
}



    // Slideshow (5s)
    function initSlideshow(intervalMs = 5000){
      const slides = document.querySelectorAll('.slide');
      const dots = document.querySelectorAll('.dot');
      if (!slides || slides.length === 0) return;
      let currentIndex = 0;
      function showSlide(i){
        slides.forEach((s, idx)=> s.classList.toggle('active', idx === i));
        dots.forEach((d, idx)=> d.classList.toggle('active', idx === i));
        currentIndex = i;
      }
      let auto = setInterval(()=> showSlide((currentIndex+1)%slides.length), intervalMs);
      dots.forEach(dot=> dot.addEventListener('click', ()=>{ clearInterval(auto); showSlide(Number(dot.dataset.index)); auto = setInterval(()=> showSlide((currentIndex+1)%slides.length), intervalMs); }));
    }


    // small helper search for grids
    function setupSearch(inputId, clearBtnId, targetId){
      const searchInput = document.getElementById(inputId); if (!searchInput) return;
      searchInput.addEventListener('input', ()=>{
        const filter = searchInput.value.toLowerCase();
        document.getElementById(targetId).querySelectorAll('.product-card').forEach(card=>{
          const text = card.textContent.toLowerCase();
          card.style.display = text.includes(filter) ? '' : 'none';
        });
      });
      const clearBtn = document.getElementById(clearBtnId);
      if (clearBtn) clearBtn.addEventListener('click', ()=>{ searchInput.value=''; searchInput.dispatchEvent(new Event('input')); });
    }

    function goToCart(){ window.location.href = 'cart.html'; }

     const SESSION_KEY = "visitorSession";
const LOCATION_KEY = "visitorLatLon";
let heartbeatTimer = null;
let lastActivityTime = Date.now();
let isTabActive = true;
const HEARTBEAT_INTERVAL = 15 * 1000; // 15 seconds
const INACTIVITY_LIMIT = 60 * 1000;   // 1 minute of inactivity

// --- Get or create session ID ---
function getSessionId() {
    const now = Date.now();
    let sessionData = null;
    try { sessionData = JSON.parse(localStorage.getItem(SESSION_KEY)); } catch {}
    if (sessionData && (now - sessionData.lastActive < 2 * 60 * 60 * 1000)) {
        sessionData.lastActive = now;
    } else {
        sessionData = { id: Math.random().toString(36).substring(2, 10), lastActive: now };
    }
    localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
    return sessionData.id;
}

// --- Get GPS location (cached per session) ---
async function getGeoLocation() {
    const cached = localStorage.getItem(LOCATION_KEY);
    if (cached) return JSON.parse(cached);
    if (!navigator.geolocation) return { lat: "unknown", lon: "unknown" };
    try {
        const pos = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 10000 });
        });
        const coords = { lat: pos.coords.latitude, lon: pos.coords.longitude };
        localStorage.setItem(LOCATION_KEY, JSON.stringify(coords));
        return coords;
    } catch {
        return { lat: "unknown", lon: "unknown" };
    }
}

// --- Get public IP ---
async function getPublicIP() {
    try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip || "unknown";
    } catch {
        return "unknown";
    }
}

// --- Core function: Send visit or heartbeat ---
async function trackVisitor(type = "pageview") {
    const sessionId = getSessionId();
    const { lat, lon } = await getGeoLocation();
    const ip = await getPublicIP();
    const page = window.location.href;
    const browser = navigator.userAgent;

    const callbackName = "visitorCallback_" + Math.random().toString(36).substring(2, 10);
    const url = new URL("https://script.google.com/macros/s/AKfycbw5tep2lIfqr0ITB_M2TQWSZ9aPXkXcK_0pX2eCL47AnEwuuQ-CIMzmTgkqsRSM6U29tw/exec");

    url.searchParams.set("callback", callbackName);
    url.searchParams.set("sessionId", sessionId);
    url.searchParams.set("ip", ip);
    url.searchParams.set("page", page);
    url.searchParams.set("browser", browser);
    url.searchParams.set("lat", lat);
    url.searchParams.set("lon", lon);
    url.searchParams.set("type", type);

    window[callbackName] = function (data) {
        console.log(`Visitor ${type}:`, data);
        delete window[callbackName];
        document.body.removeChild(script);
    };

    const script = document.createElement("script");
    script.src = url.toString();
    document.body.appendChild(script);

    // reset heartbeat timing reference
    lastActivityTime = Date.now();
    resetHeartbeat(); 
}

// --- Heartbeat Control ---
function startHeartbeat() {
    if (heartbeatTimer) return;
    heartbeatTimer = setInterval(() => {
        const now = Date.now();
        const inactive = now - lastActivityTime > INACTIVITY_LIMIT;
        if (!isTabActive || inactive) {
            console.log("Heartbeat paused (inactive/tab hidden)");
            stopHeartbeat();
            return;
        }
        trackVisitor("heartbeat");
    }, HEARTBEAT_INTERVAL);
}

function stopHeartbeat() {
    if (heartbeatTimer) {
        clearInterval(heartbeatTimer);
        heartbeatTimer = null;
    }
}

function resetHeartbeat() {
    stopHeartbeat();
    startHeartbeat();
}

// --- Activity tracking ---
function markActive() {
    lastActivityTime = Date.now();
    if (isTabActive && !heartbeatTimer) {
        console.log("User active ‚Äî restarting heartbeat");
        startHeartbeat();
    }
}

// --- Tab visibility ---
document.addEventListener("visibilitychange", () => {
    isTabActive = !document.hidden;
    if (isTabActive) {
        console.log("Tab active again ‚Äî resuming heartbeat");
        markActive();
    } else {
        console.log("Tab hidden ‚Äî stopping heartbeat");
        stopHeartbeat();
    }
});

// --- Detect user activity events ---
["mousemove", "keydown", "scroll", "touchstart"].forEach(evt =>
    window.addEventListener(evt, markActive)
);

// --- When page loads ---
window.addEventListener("DOMContentLoaded", async () => {
    await trackVisitor("pageview"); // Always call on page load
    startHeartbeat();               // Start interval heartbeat
});

// --- Stop heartbeat when leaving page ---
window.addEventListener("beforeunload", () => {
    stopHeartbeat();
});

  window.addEventListener('DOMContentLoaded', () => {
  // üõí Update cart badge
  updateCartTabCount(getCart());

  // üîñ Retrieve stored navigation context
  const fromTab = sessionStorage.getItem('fromTab');
  const fromCategory = sessionStorage.getItem('fromCategoryName');
  const fromFragranceCategory = sessionStorage.getItem('fromFragranceTag');
  const fromMenCategoryName = sessionStorage.getItem('fromMenCategoryName');

  

  // Hide all tab content initially
  document.querySelectorAll('.tabcontent').forEach(t => {
    t.classList.remove('active');
    t.style.display = 'none';
  });

  // Deactivate all tab buttons
  document.querySelectorAll('.tablink').forEach(b => b.classList.remove('active'));

  // ‚úÖ Restore correct view + highlight the corresponding tab
  if (fromTab === 'fragrance' && fromFragranceCategory) {
    // Show fragrance category view
    showProductsForFragrance(fromFragranceCategory);

    // Highlight fragrance tab
    const btn = document.getElementById('tab-fragrance');
    if (btn) btn.classList.add('active');
  } 
  else if (fromTab === 'category' && fromCategory) {
    // Show products for specific category
    showProductsForCategory(fromCategory);

    // Highlight Home tab
    const btn = document.getElementById('tab-category-nav');
    if (btn) btn.classList.add('active');
  }else if (fromTab === 'Mencategory' && fromMenCategoryName) {
    // Show products for specific category
    showProductsForMenCategory(fromMenCategoryName);

    // Highlight Home tab
    const btn = document.getElementById('tab-Mencategory-nav');
    if (btn) btn.classList.add('active');
  } 
 else {
  
    openTabFromMenu('category'); // ONLY run if no hash used
  
}


  // üßπ Optional: clear stored state to prevent repeated reloading
  sessionStorage.removeItem('fromTab');
  sessionStorage.removeItem('fromCategoryName');
  sessionStorage.removeItem('fromFragranceTag');
  sessionStorage.removeItem('fromMenCategoryName');

  // üéûÔ∏è Initialize offer banner slideshow
  initSlideshow();
});

window.addEventListener("load", () => {
  const hash = window.location.hash.replace("#", "").toLowerCase();
  if (!hash) return;

  hashTriggered = true;  // <--- FLAG SET

  if (hash === "fragrance") {
    openTab({ currentTarget: document.getElementById("tab-fragrance") }, "fragrance");
    return;
  }

  if (hash === "categoryview") {
    openCategoryView();
    return;
  }

  if (hash === "mencategoryview") {
    openMenCategoryView();
    return;
  }
});

  </script>
</body>
</html>
